define(["idcta/es6-promise"],function(d){var c={};var b=3600000;c.verifyEndpointUrl=function(e,g){try{if(g!==false){g=true}var j=new RegExp(/https?:\/\/(((www|ssl)(\.int|\.test|\.stage)?)|(pal\.sandbox\.dev))\.bbc\.(co\.uk|com)/);if(j.test(e)){if(new RegExp(/(\.com|\.co\.uk)\/.+/).test(e)){e=e.split(/(\.com|\.co\.uk)\/.+/)[0]+e.split(/(\.com|\.co\.uk)\/.+/)[1]}return e}var k="";if(e.slice(0,5)=="https"){k+=((g?"https://":"")+"ssl.");if(e.indexOf(".sandbox.")>-1){k+="sandbox.dev."}}else{k+=((g?"http://":""));if(e.indexOf(".sandbox.")>-1){k+="pal.sandbox.dev."}else{k+="www."}}var f=["int","test","stage"];for(i=0;i<f.length;i++){if(e.indexOf("."+f[i]+".")>-1){k+=f[i]+"."}}if(new RegExp(/\.co\.uk/).test(e)){k+="bbc.co.uk"}else{k+="bbc.com"}return k}catch(h){c.logCaughtError(h)}};c.alignTldWithHostname=function(g,e){try{var k=e||window.location.hostname;var h=k.split(/(\.com|\.co\.uk)$/)[1];var f=g.split(/(\.com|\.co\.uk)\/.+/)[1];if(f!==h&&h!==undefined){g=g.replace(f,h)}return g}catch(j){c.logCaughtError(j)}};c.buildIdappResourceUrl=function(f,e){try{var j;var g;if(RegExp(/^https/).test(f)){j="https"}else{j="http"}if(new RegExp(/\.sandbox\./).test(f)){g="sandbox.dev."}else{if(new RegExp(/\.int\./).test(f)){g="int."}else{if(new RegExp(/\.test\./).test(f)){g="test."}else{if(new RegExp(/\.stage\./).test(f)){g="stage."}else{g=""}}}}return j+"://static."+g+(j==="https"?"bbc":"bbci")+".co.uk/idapp/"+e+"/modules/idapp/idapp-1"}catch(h){c.logCaughtError(h)}};function a(){try{if(typeof Promise!=="undefined"){return Promise}return d.Promise}catch(e){c.logCaughtError(e)}}c.Promise=a();c.loadUrlInHiddenIframe=function(h,g,e){try{return new c.Promise(function(l,k){var j=document.createElement("iframe");j.scrolling="no";j.frameborder="0";j.width="0px";j.height="0px";j.border="0px";j.style.display="none";j.style.frameBorder="0px";j.style.borderStyle="none";var o=null;var m=function(q){var p=q.message?"message":"data";if(!q.origin.match(/\.bbc\.(co\.uk|com)(:[0-9]+)*$/)||e.indexOf(q[p])==-1){return}n();return l(q[p])};var n=function(){if(o){clearTimeout(o)}if(e){c.removeEventListener("message",m)}document.body.removeChild(j)};if(e){c.addEventListener("message",m)}else{j.onload=function(){n();return l()}}if(g){o=setTimeout(function(){n();return k()},g)}j.src=h;document.body.appendChild(j)})}catch(f){c.logCaughtError(f)}};c.addEventListener=function(f,h,e){try{if(window.addEventListener){return window.addEventListener(f,h,e)}f=(f=="message")?"onmessage":f;return window.attachEvent(f,h)}catch(g){c.logCaughtError(g)}};c.removeEventListener=function(e,g){try{if(window.removeEventListener){return window.removeEventListener(e,g)}e=(e=="message")?"onmessage":e;return window.detachEvent(e,g)}catch(f){c.logCaughtError(f)}};c.getHardcodedUrl=function(){try{var e=window.location.href;if(e.indexOf(".sandbox.")>-1){return"https://ssl.sandbox.dev.bbc.co.uk"}else{if(e.indexOf(".int.")>-1){return"https://ssl.int.bbc.co.uk"}else{if(e.indexOf(".test.")>-1){return"https://ssl.test.bbc.co.uk"}else{if(e.indexOf(".stage.")>-1){return"https://ssl.stage.bbc.co.uk"}else{return"https://ssl.bbc.co.uk"}}}}}catch(f){c.logCaughtError(f)}};c.parseUrl=function(g){try{var e=document.createElement("a");e.href=g;e.query=(e.search)?c.parseQueryString(e.search):{};return e}catch(f){c.logCaughtError(f)}};c.parseQueryString=function(k){try{if(k.charAt(0)==="?"){k=k.substring(1)}var g={};var h=k.split("&");for(var e=0;e<h.length;e++){var j=h[e].split("=");g[decodeURIComponent(j[0])]=decodeURIComponent(j[1]||"")}return g}catch(f){c.logCaughtError(f)}};c.timestampInFuture=function(g){try{var f=(new Date()).getTime();return g>f}catch(e){c.logCaughtError(e)}};c.timestampExpired=function(g){try{var f=(new Date()).getTime();return g<f}catch(e){c.logCaughtError(e)}};c.generateFutureTimestamp=function(e){try{var e=e?e:b;var g=new Date();g.setTime(g.getTime()+e);return g.getTime()}catch(f){c.logCaughtError(f)}};c.logCaughtError=function(e){if(window.console&&e.message){console.log(e)}};return c});