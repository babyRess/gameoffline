/* Blox Slider v1.0demo - http://www.bdrgames.nl - (c) 2016 BdR Games. */ 
  
MyLabelButton=function(t,e,i,s,a,h,o,n,r,l,d){Phaser.Button.call(this,t,e,i,s,h,o,n,r,l,d),this.label=new Phaser.BitmapText(t,0,0,"gomablock","A",28),this.addChild(this.label),this.setLabel(a),t.add.existing(this)},MyLabelButton.prototype=Object.create(Phaser.Button.prototype),MyLabelButton.prototype.constructor=MyLabelButton,MyLabelButton.prototype.setLabel=function(t){t=t.toUpperCase(),this.label.setText(t),this.label.update(),this.label.x=Math.floor(.5*(this.width-this.label.width)),this.label.y=Math.floor(.3*(this.height-this.label.height))},Phaser.BitmapText.prototype.makeCentered=function(t){this.updateText(),this.x=Math.floor(t-.5*this.textWidth)};var BLOCKGAME_VERION="v1.0demo",TILE_SIZE=60,TILE_SIZE_H=30,CLOUDS_YMAX=0,CLOUDS_YMAX=0,SOUND_ONOFF=1,MUSIC_ONOFF=1,MUSIC_TIT=null,MUSIC_GAM=null,blockgame={};blockgame.Bootup=function(t){},blockgame.Bootup.prototype={resize_old_width:0,resize_old_height:0,preload:function(){this.load.image("loadingbar_bg","img/loadingbar_bg.png"),this.load.image("loadingbar_fill","img/loadingbar_fill.png")},create:function(){this.input.maxPointers=1,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.setResizeCallback(this.resizeCallback,this),this.game.scale.onSizeChange.add(this.onSizeChange,this),this.state.start("Preloader")},resize:function(){},resizeCallback:function(t){if(console.log("resize_Update - common function"),this.resize_old_width!=window.innerWidth||this.resize_old_height!=window.innerHeight){console.log("resize_Update - ACTUAL RESIZE!!"),this.resize_old_width=window.innerWidth,this.resize_old_height=window.innerHeight;var e=window.innerHeight/window.innerWidth;GAME_WIDTH*e>GAME_HEIGHT?this.scale.setGameSize(GAME_WIDTH,Math.floor(GAME_WIDTH*e)):this.scale.setGameSize(GAME_WIDTH,GAME_HEIGHT)}},onSizeChange:function(){this.game.state.callbackContext.resize()}},blockgame.createRectangle=function(t,e,i,s,a,h,o){var n=t.add.graphics(e,i);return n.beginFill(h,1),n.drawRect(0,0,s,a),n.endFill(),n.alpha=o,n},blockgame.doFadeScreen=function(t,e,i){var s=e?1:0,a=e?0:1,h=i?0:16777215,o=blockgame.createRectangle(t,0,0,t.width,t.height,h,s),n=t.add.tween(o);return n.to({alpha:a},500,Phaser.Easing.Linear.None,!0),n},blockgame.cloudsInit=function(t){CLOUDS_YMAX=t;for(var e=0;10>e;e++){var i=this.game.rnd.integerInRange(1,2),s=this.add.sprite(0,0,"introsprites","cloud"+i);s.x=this.game.rnd.integerInRange(-1*s.height,this.game.world.height-s.height);var a=blockgame.cloudReset.bind(this);a(s)}},blockgame.cloudReset=function(t,e){var i=this.game.world.width,s=this.game.rnd.integerInRange(0,CLOUDS_YMAX-t.height);"undefined"==typeof e&&(i=t.x);var a=0-t.width,h=this.game.rnd.integerInRange(5,10);h=Math.floor(50*(i-a)*(h/10)),t.x=i,t.y=s;var o=this.game.add.tween(t).to({x:a},h,Phaser.Easing.Linear.None,!0);o.onComplete.add(blockgame.cloudReset.bind(this))},blockgame.switch_sound=function(t,e){SOUND_ONOFF=1-SOUND_ONOFF,console.log("blockgame.switch_sound.. -> SOUND_ONOFF="+SOUND_ONOFF),1==SOUND_ONOFF&&this.game.state.callbackContext.soundGuiButton.play(),blockgame.set_sound_btn(t)},blockgame.set_sound_btn=function(t){0==SOUND_ONOFF?t.setFrames("soundoff2","soundoff1"):t.setFrames("soundon2","soundon1")},blockgame.switch_music=function(t,e){MUSIC_ONOFF=1-MUSIC_ONOFF,console.log("switch_music .. -> MUSIC_ONOFF="+MUSIC_ONOFF),1==SOUND_ONOFF&&this.game.state.callbackContext.soundGuiButton.play(),0==MUSIC_ONOFF?(blockgame.music_doplay(MUSIC_TIT,!1),blockgame.music_doplay(MUSIC_GAM,!1)):"Game"==this.game.state.current?blockgame.music_background(1):blockgame.music_background(0),blockgame.set_music_btn(t)},blockgame.set_music_btn=function(t){0==MUSIC_ONOFF?t.setFrames("musicoff2","musicoff1"):t.setFrames("musicon2","musicon1")},blockgame.soundeffect_play=function(t){1==SOUND_ONOFF&&t.play()},blockgame.music_init=function(t){MUSIC_TIT=t.add.audio("music_title"),MUSIC_GAM=t.add.audio("music_ingame"),MUSIC_TIT.loop=!0,MUSIC_GAM.loop=!0},blockgame.music_background=function(t){1==MUSIC_ONOFF&&(blockgame.music_doplay(MUSIC_TIT,0==t),blockgame.music_doplay(MUSIC_GAM,1==t))},blockgame.music_doplay=function(t,e){1==e?0==t.isPlaying&&t.play():1==t.isPlaying&&t.stop()},blockgame.Preloader=function(t){blockgame.GAME_WIDTH=480,blockgame.GAME_HEIGHT=720},blockgame.Preloader.prototype={preload:function(){this.stage.backgroundColor="#B4D9E7",this.loadingbar_bg=this.add.sprite(80,240,"loadingbar_bg"),this.loadingbar_fill=this.add.sprite(80,240,"loadingbar_fill"),this.load.setPreloadSprite(this.loadingbar_fill),this.load.atlasJSONHash("gamesprites","img/gamesprites.png","img/gamesprites.json"),this.load.atlasJSONHash("menusprites","img/menusprites.png","img/menusprites.json"),this.load.atlasJSONHash("introsprites","img/introsprites.png","img/introsprites.json"),this.load.atlasJSONHash("buttons","img/buttons.png","img/buttons.json"),this.load.bitmapFont("myfont","font/font.png","font/font.xml"),this.load.bitmapFont("gomablock","font/gomablock.png","font/gomablock.xml"),this.load.audio("gui_button",["snd/gui_button.wav","snd/gui_button.ogg"]),this.load.audio("gui_forward",["snd/gui_forward.wav","snd/gui_forward.ogg"]),this.load.audio("game_slide",["snd/game_slide.wav","snd/game_slide.ogg"]),this.load.audio("game_bump",["snd/game_bump.wav","snd/game_bump.ogg"]),this.load.audio("game_exit",["snd/game_exit.wav","snd/game_exit.ogg"]),this.load.audio("game_win1",["snd/game_win1.wav","snd/game_win1.ogg"]),this.load.audio("game_win2",["snd/game_win2.wav","snd/game_win2.ogg"]),this.load.audio("game_win3",["snd/game_win3.wav","snd/game_win3.ogg"]),this.load.audio("game_getkey",["snd/game_getkey.wav","snd/game_getkey.ogg"]),this.load.audio("game_openlock",["snd/game_openlock.wav","snd/game_openlock.ogg"]),this.load.audio("game_sticky",["snd/game_sticky.wav","snd/game_sticky.ogg"]),this.load.audio("game_victory",["snd/game_victory.wav","snd/game_victory.ogg"]),this.load.audio("music_title",["snd/music_title.mp3","snd/music_title.ogg"]),this.load.audio("music_ingame",["snd/music_ingame.mp3","snd/music_ingame.ogg"]),this.loadLevelProgress()},loadLevelProgress:function(){if(!blockgame.PlayerProgress){var t=window.localStorage.getItem("blockgame_progress");try{blockgame.PlayerProgress=JSON.parse(t)}catch(e){blockgame.PlayerProgress=[]}"[object Array]"!==Object.prototype.toString.call(blockgame.PlayerProgress)&&(blockgame.PlayerProgress=[])}},create:function(){blockgame.music_init(this.game),this.state.start("MainMenu")},resize:function(){}};var MENU_ENTER_LEFT=1,MENU_ENTER_RIGHT=2,MENU_EXIT_LEFT=3,MENU_EXIT_RIGHT=4;blockgame.MainMenu=function(t){this.game=t,this._grpMainMenu=null,this._backimage=null,this._btnStart=null,this._btnOptions=null,this._btnCredits=null,this._grpCredits=null,this._btnCreditsOk=null,this._strCheatCode=""},blockgame.MainMenu.prototype={create:function(){this.stage.backgroundColor="#E0F0E4",blockgame.music_background(0),blockgame.cloudsInit.call(this,64),this._backimage=this.add.sprite(0,0,"menusprites","title_image"),this._backimage.y=this.game.height-this._backimage.height;var t=this.add.sprite(0,0,"menusprites","title_logo");t.x=.5*(blockgame.GAME_WIDTH-t.width),t.y=0-t.height,this.game.add.tween(t).to({y:32},400,Phaser.Easing.Back.Out,!0,200),t.inputEnabled=!0,t.events.onInputDown.add(this.onTitleTouch,this),this._grpMainMenu=this.game.add.group(),this._btnStart=new MyLabelButton(this.game,100,this.game.height-80-10,"buttons","Start",this.doStart,this,"button2","button1"),this._btnOptions=this.game.add.button(this.game.width+this.game.width-102-10,16,"buttons",this.doOptions,this,"settings2","settings1"),this.btnSound=this.game.add.button(this.game.width-45,6,"buttons",blockgame.switch_sound,this,"soundon2","soundon1"),this.btnMusic=this.game.add.button(this.game.width-45,56,"buttons",blockgame.switch_music,this,"musicon2","musicon1"),blockgame.set_sound_btn(this.btnSound),blockgame.set_music_btn(this.btnMusic);var e=250,i=this.blackPanel(0,e,480,140),s=this.game.add.bitmapText(0,e,"myfont","Demo version\nFor licensing information\ncontact: info@bdrgames.nl",32);s.x=(this.game.width-s.width)/2,this._grpMainMenu.add(i),this._grpMainMenu.add(s),this._grpMainMenu.add(this._btnStart),this._grpOptions=this.game.add.group();var a=new MyLabelButton(this.game,100,0,"buttons","Reset game",this.doResetGame,this,"button2","button1"),h=new MyLabelButton(this.game,100,80,"buttons","Credits",this.doCredits,this,"button2","button1"),o=new MyLabelButton(this.game,100,160,"buttons","Back",this.doBack,this,"button2","button1");this._grpOptions.add(a),this._grpOptions.add(h),this._grpOptions.add(o),this._grpOptions.y=320,this._grpResetGame=this.game.add.group();var n=this.blackPanel(40,0,400,300),r=this.game.add.bitmapText(320,8,"myfont","Reset game progress,\nare you sure?",40);r.align="center",r.makeCentered(240);var l=new MyLabelButton(this.game,100,128,"buttons","Yes",this.doResetGameOk,this,"button2","button1"),d=new MyLabelButton(this.game,100,208,"buttons","No",this.doBack,this,"button2","button1");this._grpResetGame.add(n),this._grpResetGame.add(r),this._grpResetGame.add(l),this._grpResetGame.add(d),this._grpResetGame.y=272,this._grpCredits=this.game.add.group();var g="Program and puzzles by\n    Bas de Reuver\n";g+="Graphics and artwork by\n    Delfo Pinto\n",g+="Music by\n    Sate (EnvatoMarket)";var _=this.blackPanel(40,0,400,392),c=this.game.add.bitmapText(160,0,"myfont",g,26);c.makeCentered(240);var m=this.game.add.bitmapText(320,350,"myfont","BdR GamesÂ©2016",40);m.makeCentered(240);var u=this.game.add.sprite(140,200,"menusprites","logo_bdr"),p=this.game.add.sprite(260,200,"menusprites","logo_phaser"),y=new MyLabelButton(this.game,100,280,"buttons","Ok",this.doBack,this,"button2","button1"),b=this.game.add.bitmapText(220,260,"myfont",BLOCKGAME_VERION,20);this._cheatText=this.game.add.bitmapText(320,-240,"myfont","Levels unlocked",48),this._cheatText.makeCentered(240),this._cheatText.alpha=0,this._grpCredits.add(_),this._grpCredits.add(c),this._grpCredits.add(m),this._grpCredits.add(u),this._grpCredits.add(p),this._grpCredits.add(y),this._grpCredits.add(b),this._grpCredits.add(this._cheatText),this._grpCredits.y=200,this._grpMainMenu.x=-1*this.game.width,this._grpOptions.x=this.game.width,this._grpResetGame.x=this.game.width,this._grpCredits.x=this.game.width,this.soundGuiButton=this.game.add.audio("gui_button"),this.soundGuiForward=this.game.add.audio("gui_forward"),this.game.input.keyboard.addCallbacks(this,this.doMenuKeyInput,null,null),this.game.time.events.add(200,function(){this.moveMainMenu(!0)},this)},resize:function(){console.log("resize() inMainMenu -> size = "+window.innerHeight+" x "+window.innerWidth),this._backimage.y=this.game.height-this._backimage.height;var t=this.game.height/2;this._grpMainMenu.y=this.game.height-600,this._grpOptions.y=t,this._grpResetGame.y=t-32,this._grpCredits.y=t-100},blackPanel:function(t,e,i,s){var a=this.game.add.graphics(t,e);return a.beginFill(0,.75),a.drawRect(0,0,i,s),a.endFill(),a},update:function(){},onTitleTouch:function(t,e){if(0==this._grpCredits.x){var i=new Phaser.Rectangle(t.x,t.y,t.width,t.height/2),s=new Phaser.Rectangle(t.x,t.y+t.height/2,t.width,t.height/2),a="-";1==i.contains(e.x,e.y)&&(a="T"),1==s.contains(e.x,e.y)&&(a="B"),this._strCheatCode+=a,this._strCheatCode.length>8&&(this._strCheatCode=this._strCheatCode.substring(this._strCheatCode.length-8)),"TBTBTTBB"==this._strCheatCode&&(this._strCheatCode="",this.CheatUnlockAll(),this._cheatText.y=-2*this._cheatText.height,this._cheatText.alpha=1,this.game.add.tween(this._cheatText).to({y:this._cheatText.y-80,alpha:0},300,Phaser.Easing.Linear.None,!0,600),blockgame.soundeffect_play(this.soundGuiForward))}},CheatUnlockAll:function(){blockgame.PlayerProgress||this.game.state.states.LevelSelect.loadLevelProgress();for(var t=0;t<BlockGame_LevelData.length;t++){var e=45>t?3:0;(!blockgame.PlayerProgress[t]||blockgame.PlayerProgress[t]<e)&&(blockgame.PlayerProgress[t]=e)}window.localStorage.setItem("blockgame_progress",JSON.stringify(blockgame.PlayerProgress))},doMenuKeyInput:function(t){var e=t.keyCode;27==e?this.doBack():0==this._grpResetGame.x?(78==e&&this.doBack(),89==e&&this.doResetGameOk()):32==e&&this.doStart()},doStart:function(){blockgame.soundeffect_play(this.soundGuiForward);var t=blockgame.PlayerProgress[0],e=blockgame.doFadeScreen(this.game,!1,!0);0>t||"undefined"==typeof t?(this.game.state.states.Cutscene._IntroOutro=0,e.onComplete.add(function(){this.state.start("Cutscene")},this)):(this.game.state.states.LevelSelect._offset=0,e.onComplete.add(function(){this.state.start("LevelSelect")},this))},doOptions:function(){blockgame.soundeffect_play(this.soundGuiForward),this.moveMainMenu(!1),this.moveScene(this._grpOptions,MENU_ENTER_RIGHT)},doResetGame:function(){blockgame.soundeffect_play(this.soundGuiForward),this.moveScene(this._grpOptions,MENU_EXIT_LEFT),this.moveScene(this._grpResetGame,MENU_ENTER_RIGHT)},doCredits:function(){blockgame.soundeffect_play(this.soundGuiForward),this.moveScene(this._grpOptions,MENU_EXIT_LEFT),this.moveScene(this._grpCredits,MENU_ENTER_RIGHT)},doBack:function(){return 0==this.soundGuiForward.isPlaying&&blockgame.soundeffect_play(this.soundGuiButton),0==this._grpResetGame.x?(this.moveScene(this._grpOptions,MENU_ENTER_LEFT),this.moveScene(this._grpResetGame,MENU_EXIT_RIGHT),!1):0==this._grpCredits.x?(this.moveScene(this._grpOptions,MENU_ENTER_LEFT),this.moveScene(this._grpCredits,MENU_EXIT_RIGHT),!1):0==this._grpOptions.x?(this.moveMainMenu(!0),this.moveScene(this._grpOptions,MENU_EXIT_RIGHT),!1):!0},doResetGameOk:function(){blockgame.soundeffect_play(this.soundGuiForward),blockgame.PlayerProgress=[],window.localStorage.removeItem("blockgame_progress"),this.doBack()},moveMainMenu:function(t){var e=t?MENU_ENTER_LEFT:MENU_EXIT_LEFT,i=t?MENU_ENTER_RIGHT:MENU_EXIT_RIGHT;this.moveScene(this._grpMainMenu,e,0),this.moveScene(this._btnOptions,i,this.game.width-102-10)},moveScene:function(t,e,i){"undefined"==typeof i&&(i=0);var s=-1*this.game.width,a=0;e==MENU_ENTER_RIGHT&&(s=this.game.width,a=0),e==MENU_EXIT_LEFT&&(s=0,a=-1*this.game.width),e==MENU_EXIT_RIGHT&&(s=0,a=this.game.width);var s=s+i,a=a+i;t.x=s,this.game.add.tween(t).to({x:a},400,Phaser.Easing.Back.Out,!0)}};var BlockGame_LevelData=[{id:"1",tag:"EASY_1",layout:"550f000202020000000002020000000202000000000202020001",solution:"RDRLULDRDR",tutorial:1},{id:"3",tag:"EASY_3",layout:"550f140200000218000000020000000000000200020000000001",solution:"DRURDR",tutorial:3},{id:"00",tag:"EASY",layout:"550f000021260002000028000000000014000002001912000001",solution:"URDR"},{id:"5",tag:"EASY",layout:"5602020200000f000200001516102526191a20292a00000200010000020202",solution:"DLURD"},{id:"00",tag:"EASY_dif",layout:"5502000000020200020002140f00002418000100280200000002",solution:"ULURDLU"},{id:"00",tag:"EASY_good",layout:"460f000000000200002415162428191a280000020000000001",solution:"DRURULDR"},{id:"00",tag:"EASY",layout:"450f10000002100200000000000002200200002001",solution:"RULDLDRDLUR"},{id:"00",tag:"EASY_vert GOOD",layout:"470f005400020058000000000000616200000000000054000200580001",solution:"RDLURDRULDR",tutorial:4},{id:"00",tag:"MED magn GOOD",layout:"660f0000000002003132003400000000003800003400000000003800313200020000000001",solution:"RDRULDR",tutorial:5},{id:"00",tag:"MED stick GOOD",layout:"550f020002004010004010000000000010400010400002000201",solution:"RDLURD",tutorial:7},{id:"00",tag:"HARD 2guy norm GOOD",layout:"55000000000e0002021112000200002000240002000f28100001",solution:"DRULURURDRDLDURDLD"},{id:"00",tag:"HARD GOOD sticky double ending",layout:"550f0002000e4010002040104000402002000000020202010202",solution:"LDLURDLURDRD"}],LEVEL_SELECT_X=3,LEVEL_SELECT_Y=5;blockgame.LevelSelect=function(t){this.game=t,this.btnReset=null,this._txtSelect=null,this._icons=[],this._offset=0,this._extra=!1,this._testing=0},blockgame.LevelSelect.prototype={create:function(){this._testing=0,this.stage.backgroundColor="#B4D9E7",blockgame.music_background(0);for(var t=BlockGame_LevelData.length,e=0,i=0,s=0;t>s;s++)blockgame.PlayerProgress[s]&&blockgame.PlayerProgress[s]>0&&(e+=blockgame.PlayerProgress[s],i++);this._extra=e>=120&&i>=t,blockgame.cloudsInit.call(this,this.game.height);var a=381,h=Math.floor((this.game.width-a)/2);this._tower=this.game.add.tileSprite(h,0,a,this.game.height,"menusprites","levelselect_tower"),this._txtSelect=this.game.add.bitmapText(240,16,"gomablock","",28),this.sprStar=this.game.add.sprite(this.game.width-48,this.game.height-48,"menusprites","levelselect_star"),t=this._extra?BlockGame_LevelData.length:t,this.txtStar=this.game.add.bitmapText(240,this.game.height-48,"myfont",e+"/"+3*t,32),this.txtStar.update(),this.txtStar.x=this.game.width-56-this.txtStar.width;var o=Math.floor((this.game.height-80)/2);this.btnBack=this.game.add.button(10,this.game.height-74-10,"buttons",this.doBtnBack,this,"exit2","exit1"),this.btnPrev=this.game.add.button(82,o,"buttons",this.doPrevLevels,this,"play2","play1"),this.btnNext=this.game.add.button(this.game.width-74-10,o,"buttons",this.doNextLevels,this,"play2","play1"),this.btnPrev.scale.x=-1,this.btnSound=this.game.add.button(this.game.width-45,6,"buttons",blockgame.switch_sound,this,"soundon2","soundon1"),this.btnMusic=this.game.add.button(this.game.width-45,56,"buttons",blockgame.switch_music,this,"musicon2","musicon1"),blockgame.set_sound_btn(this.btnSound),blockgame.set_music_btn(this.btnMusic),this.soundGuiButton=this.game.add.audio("gui_button"),this.soundGuiForward=this.game.add.audio("gui_forward"),this.soundBump=this.game.add.audio("game_bump"),this.game.input.keyboard.addCallbacks(this,this.doSelectKeyInput,null,null),this.createLevelIcons(),this.updateLevelsPage(0);var n=this.game.add.bitmapText(240,this._icons[0].y+80*(LEVEL_SELECT_Y-1),"myfont","45 levels in\nfull version",48);n.x=(this.game.width-n.width)/2,blockgame.doFadeScreen(this.game,!0,!0)},resize:function(){console.log("resize() in LevelSelect -> size = "+window.innerHeight+" x "+window.innerWidth);var t=Math.floor((this.game.height-80)/2);this.btnBack.y=this.game.height-74-10,this.btnPrev.y=t,this.btnNext.y=t,this.sprStar.y=this.game.height-48,this.txtStar.y=this.game.height-48,this.resize_LevelIcons(),this._tower.height=this.game.height},createLevelIcons:function(){var t=0;this._icons=[];for(var e=0;LEVEL_SELECT_Y>e;e++)for(var i=0;LEVEL_SELECT_X>i;i++)this._icons[t]=this.createLevelIcon(t),t++;this.resize_LevelIcons()},resize_LevelIcons:function(){for(var t=0,e=Math.floor((this.game.width-80*LEVEL_SELECT_X)/2),i=Math.floor((this.game.height-88*LEVEL_SELECT_Y)/2),s=0;LEVEL_SELECT_Y>s;s++)for(var a=0;LEVEL_SELECT_X>a;a++){var h=e+80*a+40,o=i+88*s+40;this._icons[t].x=h,this._icons[t].y=o,this._icons[t].xOrg=h,this._icons[t].yOrg=o,t++}},doSelectKeyInput:function(t){var e=t.keyCode;console.log("doSelectKeyInput - key.keyCode="+t.keyCode),37==e||100==e?this.doPrevLevels():39==e||102==e?this.doNextLevels():27==e||81==e?this.doBtnBack():32==e?this.doStartLastUnlocked():69==e&&(this._testing=1)},doStartLastUnlocked:function(){for(var t=3,e=-1,i=0;i<this._icons.length;i++){var s=this._icons[i].children[0].health,a=blockgame.PlayerProgress[s-1];console.log("doStartLastUnlocked - checking this._icons["+i+"] -- playdata="+a),a>=0&&t>a&&(t=a,e=i,console.log("doStartLastUnlocked - found new minimum stars, playdata="+a+", level="+s))}-1!=e&&(console.log("doStartLastUnlocked - OK start level "+s),this.onLevelIconDown(this._icons[e].children[0]))},shutdown:function(){console.log("***** SHUTDOWN *******");for(var t=this._icons.length-1;t>=0;t--)console.log("  DO IT!! delete this._icons["+t+"]"),delete this._icons[t]},createLevelIcon:function(t){var e=this.game.add.group(),i=this.game.add.sprite(-36,-36,"menusprites","levelselect_icon1a");i.health=t,i.levelIsLocked=!1,i.inputEnabled=!0,i.events.onInputDown.add(this.onLevelIconDown,this),e.add(i);var s=this.game.add.bitmapText(0,-12,"gomablock",""+(t+1),28);s.makeCentered(2),e.add(s);var a=this.game.add.sprite(-23,20,"menusprites","levelselect_stars0");return e.add(a),e.visible=!1,e},doNextLevels:function(){1==this.btnNext.visible&&(blockgame.soundeffect_play(this.soundGuiButton),this.updateLevelsPage(1))},doPrevLevels:function(){1==this.btnPrev.visible&&(blockgame.soundeffect_play(this.soundGuiButton),this.updateLevelsPage(-1))},updateLevelsPage:function(t){-1==t&&(this._offset=this._offset-this._icons.length),1==t&&(this._offset=this._offset+this._icons.length);var e=0;this._extra&&(e=BlockGame_LevelData.length-(BlockGame_LevelData.length-1)%this._icons.length-1),this._offset<=0&&(this._offset=0),this._offset>=e&&(this._offset=e),this.btnPrev.visible=this._offset>0,this.btnNext.visible=this._offset<e;var i=this._txtSelect.x-80*t,s=this.game.add.tween(this._txtSelect).to({x:i,alpha:0},200,Phaser.Easing.Linear.None,!0);s.pagestep=t,s.onComplete.add(this.updateLevelText.bind(this),this),this.refreshAllLevelIcons()},refreshAllLevelIcons:function(){for(var t=0;t<this._icons.length;t++){var e=this._icons[t],i=Math.floor(t/LEVEL_SELECT_X)+t%LEVEL_SELECT_X;console.log("updateAllLevelIcons - i="+t+" startdelay"+i),i=100*i,e.scale.x=1;var s=this.game.add.tween(e.scale).to({x:.01},200,Phaser.Easing.Linear.None,!0,i);s.levelindex=t,s.onComplete.add(this.updateLevelIcon.bind(this),this)}},doBtnBack:function(){blockgame.soundeffect_play(this.soundGuiButton),this.state.start("MainMenu")},updateLevelText:function(t,e){var i=(Math.floor(this._offset/this._icons.length),"Demo");this._txtSelect.text=i.toUpperCase(),this._txtSelect.makeCentered(240);var s=this._txtSelect.x;this._txtSelect.x=this._txtSelect.x+80*e.pagestep;this.game.add.tween(this._txtSelect).to({x:s,alpha:1},200,Phaser.Easing.Linear.None,!0)},updateLevelIcon:function(t,e){var i=e.levelindex,s=this._icons[i],a=this._offset+i+1,h=Math.min(Math.floor(this._offset/this._icons.length),2);if(a>BlockGame_LevelData.length)s.visible=!1;else{s.visible=!0;var o=blockgame.PlayerProgress[a-1];"number"==typeof o||(blockgame.PlayerProgress[a-1]=-1,o=-1),blockgame.PlayerProgress?blockgame.PlayerProgress.length>=a-1?o=blockgame.PlayerProgress[a-1]:blockgame.PlayerProgress[a-1]=-1:blockgame.PlayerProgress=[],1==a&&0>o&&(o=0);var n=!0,r=0;o>=0&&(n=!1,3>=o&&(r=o)),s.children[0].health=a,s.children[0].levelIsLocked=n,s.children[1].text=""+a,s.children[1].makeCentered(2),n?(s.children[0].frameName="levelselect_icon"+(h+1)+"a",s.children[2].visible=!1):(s.children[0].frameName="levelselect_icon"+(h+1)+"b",s.children[2].visible=!0,s.children[2].frameName="levelselect_stars"+r);var l=0;s.scale.x=.01;var e=this.game.add.tween(s.scale).to({x:1},200,Phaser.Easing.Linear.None,!0,l)}},onLevelIconDown:function(t,e){var i=t.health,s=t.levelIsLocked;if(console.log("onLevelIconDown - levelnr="+i),s){blockgame.soundeffect_play(this.soundBump);var a=this._icons[i-this._offset-1],h=a.xOrg,o=this.game.add.tween(a).to({x:h+6},20,Phaser.Easing.Linear.None).to({x:h-5},20,Phaser.Easing.Linear.None).to({x:h+4},20,Phaser.Easing.Linear.None).to({x:h-3},20,Phaser.Easing.Linear.None).to({x:h+2},20,Phaser.Easing.Linear.None).to({x:h},20,Phaser.Easing.Linear.None).start()}else{blockgame.soundeffect_play(this.soundGuiForward);var a=this._icons[i-this._offset-1],o=this.game.add.tween(a.scale).to({x:.9,y:.9},100,Phaser.Easing.Linear.None).to({x:1,y:1},100,Phaser.Easing.Linear.None).start();o.onComplete.add(function(){this.onLevelSelected(t.health)},this)}},onLevelSelected:function(t){console.log("onLevelSelected ---> levelnr="+t),this.game.state.states.Game._levelIndex=t-1;var e=blockgame.doFadeScreen(this.game,!1,!0);1==t?(this.game.state.states.Cutscene._IntroOutro=this._testing,e.onComplete.add(function(){this.state.start("Cutscene")},this)):e.onComplete.add(function(){this.state.start("Game")},this)}},blockgame.Cutscene=function(t){this.game=t,this.btnReset=null,this._icons=[],this._IntroOutro=0,this._ScenePart=0,this._timerNext=null},blockgame.Cutscene.prototype={create:function(){this.stage.backgroundColor="#706084",this._background=this.game.add.sprite(0,0,"introsprites","background"),this._moon=this.game.add.sprite(0,0,"introsprites","moon"),blockgame.cloudsInit.call(this,this.game.height-277),this._tower=this.game.add.sprite(13,41,"introsprites","tower"),this._evilSmall=this.game.add.sprite(72,256,"introsprites","mallux_small"),this._dragonSmall=this.game.add.sprite(72,256,"introsprites","dragon_small"),this._exclaim=this.game.add.sprite(72,242,"introsprites","exclaimation"),1==this._IntroOutro&&(this._emitDust=this.game.add.emitter(0,0,50)),this._mountains1=this.game.add.sprite(186,138,"introsprites","mountains1"),this._mountains2=this.game.add.sprite(251,273,"introsprites","mountains2"),this._forest=this.game.add.sprite(0,263,"introsprites","forest"),this._grassyhill=this.game.add.sprite(0,323,"introsprites","grassyhill"),this._dialog=new CutsceneDialog(this.game,0,this.game.height-128),this.btnSkip=this.game.add.button(this.game.width-36-12,48,"buttons",this.doBtnSkip,this,"play2","play1"),this.btnSkip.anchor.setTo(.5,.5),this.soundGuiButton=this.game.add.audio("gui_button"),this.game.input.keyboard.addCallbacks(this,this.doCutsceneKeyInput,null,null),this.initCutscene(),this.resize(),console.log("INIT TEST: this._tower.x,y="+this._tower.x+","+this._tower.y),console.log("INIT TEST: this._evilSmall.x,y="+this._evilSmall.x+","+this._evilSmall.y),console.log("INIT TEST: this._dragonSmall.x,y="+this._dragonSmall.x+","+this._dragonSmall.y),console.log("INIT TEST: this._mountains1.x,y="+this._mountains1.x+","+this._mountains1.y),console.log("INIT TEST: this._mountains2.x,y="+this._mountains2.x+","+this._mountains2.y),console.log("INIT TEST: this._forest.x,y="+this._forest.x+","+this._forest.y),console.log("INIT TEST: this._grassyhill.x,y="+this._grassyhill.x+","+this._grassyhill.y),0==this._IntroOutro?this.nextIntroScene():this.nextOutroScene()},render:function(){},resize:function(){console.log("resize() in Cutscene -> size = "+window.innerHeight+" x "+window.innerWidth),this._tower.y=this.game.height-this._tower.height-227,this._evilSmall.y=this._tower.y+136,this._dragonSmall.yOrg=this._tower.y+40,this._dragonSmall.xOrg=this._tower.x+50,this._dragonSmall.y=this._dragonSmall.yOrg,this._dragonSmall.x=this._dragonSmall.xOrg,this._dragonSmall.visible=!1,this._exclaim.y=this._tower.y+124,this._exclaim.yOrg=this._exclaim.y,this._evilSmall.visible=!1,this._exclaim.visible=!1,this._mountains2.y=this.game.height-this._mountains2.height-176,this._mountains2.x=this.game.width-this._mountains2.width-72,this._mountains1.y=this.game.height-this._mountains1.height-239,this._mountains1.x=this.game.width-this._mountains1.width,this._forest.anchor.setTo(0,1),this._forest.y=this.game.height-149,this._grassyhill.y=this.game.height-this._grassyhill.height,this._dialog.y=this.game.height-128,this._dialog.yOrg=this._dialog.y,this._charGirl.yOrg=this.game.height-this._charGirl.height-120,this._charGuy.yOrg=this.game.height-this._charGuy.height-120,this._charEvil.yOrg=this.game.height-480,this._grpDragon.yOrg=0-this._grpDragon.children[0].height,this._grpDragon.y=this._grpDragon.yOrg,1==this._IntroOutro&&(this._emitDust.y=this._tower.y+248)},initCutscene:function(){this._charGirl=this.game.add.sprite(0,0,"introsprites","peach_0"),this._charGuy=this.game.add.sprite(0,0,"introsprites","blu_0"),this._charEvil=this.game.add.sprite(0,0,"introsprites","mallux_0");var t=this.game.add.sprite(0,0,"introsprites","dragon");this._grpDragon=this.game.add.group(),this._grpDragon.add(t),this._charGirl.xOrg=12,this._charGuy.xOrg=this.game.width-this._charGuy.width-12,this._charEvil.xOrg=Math.floor((this.game.width-this._charEvil.width)/2),this._charEvil.visible=!1,this._grpDragon.xOrg=Math.floor((this.game.width-t.width)/2),this._grpDragon.x=this._grpDragon.xOrg,this.talktween=null,this.stopTalkAnimation(),this._ScenePart=0,1==this._IntroOutro&&(this._charGirl.scale.x=.5,this._charGirl.scale.y=.5,this._charGuy.scale.x=.5,this._charGuy.scale.y=.5,this._charGirl.alpha=0,this._charGuy.alpha=0,this._emitDust.makeParticles("introsprites",["dustcloud1","dustcloud2"]),this._emitDust.x=88,this._emitDust.setSize(140,100),this._emitDust.setXSpeed(0,0),this._emitDust.setYSpeed(0,0),this._emitDust.setRotation(-180,180),this._emitDust.setScale(.1,1,.1,1,2e3,Phaser.Easing.None),this._emitDust.setAlpha(1,.1,2e3),this._emitDust.gravity=0)},nextIntroScene:function(){this._timerNext&&this.game.time.events.remove(this._timerNext),this._ScenePart++;var t=5e3;switch(this._ScenePart){case 1:this.stopTalkAnimation(),t=1e3;break;case 2:this.stopTalkAnimation(),this.startTalkAnimation(1,0),this._dialog.initText("What a great picnic.\nBut I'm a little worried",1);break;case 3:this.startTalkAnimation(1,0),this._dialog.initText("They say an evil wizard\nlives in that tower",1);break;case 4:this.startTalkAnimation(2,0),this._dialog.initText("Don't worry, this intro\ncut-scene looks nice.",2);break;case 5:this.startTalkAnimation(2,0),this._dialog.initText("What could possibly\ngo wrong..?",2);break;case 6:this.stopTalkAnimation(),this.smallEvilAppear(),t=2e3;break;case 7:this._charGirl.frameName="peach_1",this._charGuy.frameName="blu_1",this.bigEvilAppear(),t=500;break;case 8:this.startTalkAnimation(3,0),this._dialog.initText("huh..?\nWhat's this..?",3);break;case 9:this.startTalkAnimation(3,0),this._dialog.initText("Trespassers! On my\nfreshly mowed lawn!!",3);break;case 10:this.startTalkAnimation(3,0),this._dialog.initText("Smaullux, my precious,\nget them!!",3);break;case 11:this.stopTalkAnimation(),this._charEvil.scale.x=1,this._charEvil.scale.y=1,this._charEvil.x=this._charEvil.xOrg,this._charEvil.y=this._charEvil.yOrg;var e=this.game.add.tween(this._charEvil).to({x:this._evilSmall.x,y:this._evilSmall.y},400,Phaser.Easing.Linear.None);this.game.add.tween(this._charEvil.scale).to({x:.16,y:.16},400,Phaser.Easing.Linear.None,!0);e.onComplete.add(this.nextIntroScene,this),e.start();break;case 12:this._charEvil.visible=!1,this._dragonSmall.visible=!0;var i=(this._dragonSmall.x,this._dragonSmall.y),s=Math.round((this.game.width-this._dragonSmall.x)/2),a=(Math.round((this._dragonSmall.y+this._dragonSmall.height)/4),this.game.add.tween(this._dragonSmall).to({x:s},600,Phaser.Easing.Quadratic.InOut).start(),this.game.add.tween(this._dragonSmall).to({y:i-20},400,Phaser.Easing.Quadratic.Out).to({y:i+12},400,Phaser.Easing.Quadratic.InOut).to({y:i-12},400,Phaser.Easing.Quadratic.InOut).to({y:i+12},400,Phaser.Easing.Quadratic.InOut).to({y:i-12},400,Phaser.Easing.Quadratic.InOut).to({y:i+12},400,Phaser.Easing.Quadratic.InOut).to({y:i-12},400,Phaser.Easing.Quadratic.InOut).to({y:i+12},400,Phaser.Easing.Quadratic.InOut).to({y:0-this._dragonSmall.height},400,Phaser.Easing.Quadratic.InOut));a.onComplete.add(this.nextIntroScene,this),a.start();break;case 13:this._charGirl.frameName="peach_3",this._charGuy.frameName="blu_3",this.stopTalkAnimation(),this._dialog.initText("Oh noes!\nAaaah!!",4);var i=this._grpDragon.xOrg,h=this.game.height-560,a=(Math.round((h-i)/4),this.game.add.tween(this._grpDragon).to({y:h+20},400,Phaser.Easing.Quadratic.Out).to({y:h-20},400,Phaser.Easing.Quadratic.InOut).to({y:h+20},400,Phaser.Easing.Quadratic.InOut).to({y:h-20},400,Phaser.Easing.Quadratic.InOut).to({y:h+20},400,Phaser.Easing.Quadratic.InOut).to({y:h-20},400,Phaser.Easing.Quadratic.InOut).to({y:h+20},400,Phaser.Easing.Quadratic.InOut).to({y:h-20},400,Phaser.Easing.Quadratic.InOut).to({y:h+20},400,Phaser.Easing.Quadratic.InOut).to({y:h-20},400,Phaser.Easing.Quadratic.InOut).to({y:h+20},400,Phaser.Easing.Quadratic.InOut).to({y:h-20},400,Phaser.Easing.Quadratic.InOut).to({y:h+20},400,Phaser.Easing.Quadratic.InOut).start());break;case 14:this.stopTalkAnimation();var s=this._charGirl.x,h=this._charGirl.y-200,o=this.game.add.tween(this._grpDragon).to({x:s,y:h},400,Phaser.Easing.Quadratic.Out);o.onComplete.add(this.nextIntroScene,this),o.start();break;case 15:this._grpDragon.add(this._charGirl),this._charGirl.x=this._charGirl.x-this._grpDragon.x,this._charGirl.y=this._charGirl.y-this._grpDragon.y;
var n=this._grpDragon.xOrg,r=this.game.height-560,l=this._charGuy.x-100,d=this._charGuy.y-200,o=this.game.add.tween(this._grpDragon).to({x:n,y:r},400,Phaser.Easing.Quadratic.Out).to({x:l,y:d},400,Phaser.Easing.Quadratic.InOut);o.onComplete.add(this.nextIntroScene,this),o.start();break;case 16:this._charGuy.x=this._charGuy.x-this._grpDragon.x,this._charGuy.y=this._charGuy.y-this._grpDragon.y,this._grpDragon.add(this._charGuy);var o=this.game.add.tween(this._grpDragon).to({x:this._dragonSmall.xOrg,y:this._dragonSmall.yOrg},1e3,Phaser.Easing.Quadratic.Out);o.onComplete.add(this.nextIntroScene,this),o.start();this.game.add.tween(this._grpDragon.scale).to({x:.18,y:.18},1e3,Phaser.Easing.Quadratic.Out,!0);break;case 17:this._grpDragon.visible=!1;break;case 18:this.doBtnSkip()}this._ScenePart<=18&&(this._timerNext=this.game.time.events.add(t,this.nextIntroScene,this))},nextOutroScene:function(){this._timerNext&&this.game.time.events.remove(this._timerNext),this._ScenePart++;var t=5e3;switch(this._ScenePart){case 1:this.stopTalkAnimation(),this.startTalkAnimation(1,0),this._dialog.initText("Quickly, this way\nto the exit!",1),this._dialog.initText("Final scene missing\nfrom demo version.",1);break;case 2:var e=Math.floor((this._mountains2.y-this._dragonSmall.height)/2),i=this.game.add.bitmapText(0,e,"myfont","The End",48);i.updateText(),i.x=Math.floor((this.game.width-i.textWidth)/2)}this._ScenePart<2&&(this._timerNext=this.game.time.events.add(t,this.nextOutroScene,this))},stopTalkAnimation:function(){this.talktween&&this.game.tweens.remove(this.talktween),this._charGirl.x=this._charGirl.xOrg,this._charGirl.y=this._charGirl.yOrg,this._charGuy.x=this._charGuy.xOrg,this._charGuy.y=this._charGuy.yOrg,this._charEvil.x=this._charEvil.xOrg,this._charEvil.y=this._charEvil.yOrg},startTalkAnimation:function(t,e){this.stopTalkAnimation();var i=this._charGirl;i=2==t?this._charGuy:3==t?this._charEvil:this._charGirl,this._charEvil.visible=3==t,this.talktween=this.game.add.tween(i).to({y:i.yOrg-18},200,Phaser.Easing.Quadratic.Out).to({y:i.yOrg},100,Phaser.Easing.Quadratic.In).to({y:i.yOrg-12},100,Phaser.Easing.Quadratic.Out).to({y:i.yOrg},100,Phaser.Easing.Quadratic.In).to({y:i.yOrg-6},100,Phaser.Easing.Quadratic.Out).to({y:i.yOrg},100,Phaser.Easing.Quadratic.In).to({y:i.yOrg},300,Phaser.Easing.Linear.None).repeatAll(6).start()},smallEvilAppear:function(){this._evilSmall.x=56,this._exclaim.y=this._exclaim.yOrg;var t=this._exclaim.yOrg;this._evilSmall.alpha=0,this._exclaim.alpha=0;this.game.add.tween(this._evilSmall).to({alpha:1},400,Phaser.Easing.Linear.None,!0),this.game.add.tween(this._exclaim).to({alpha:1},400,Phaser.Easing.Linear.None,!0),this.game.add.tween(this._evilSmall).to({x:72},400,Phaser.Easing.Linear.None,!0),this.game.add.tween(this._exclaim).to({y:t},200,Phaser.Easing.Quadratic.Out).to({y:t-12},100,Phaser.Easing.Quadratic.Out).to({y:t},100,Phaser.Easing.Quadratic.In).to({y:t-6},100,Phaser.Easing.Quadratic.Out).to({y:t},100,Phaser.Easing.Quadratic.In).start();this._evilSmall.visible=!0,this._exclaim.visible=!0},bigEvilAppear:function(){this._evilSmall.visible=!1,this._exclaim.visible=!1,this._charEvil.visible=!0,this._charEvil.scale.x=.16,this._charEvil.scale.y=.16,this._charEvil.x=this._evilSmall.x,this._charEvil.y=this._evilSmall.y;this.game.add.tween(this._charEvil).to({x:this._charEvil.xOrg,y:this._charEvil.yOrg},400,Phaser.Easing.Linear.None,!0),this.game.add.tween(this._charEvil.scale).to({x:1,y:1},400,Phaser.Easing.Linear.None,!0)},continueOutroSky:function(t,e){var i=0,s=0;this._evilSmall.scale.x=1,this._dragonSmall.scale.x=1,console.log("TESTING!! this._evilSmall.scale.x = 1.0 ===> width is nu "+this._evilSmall.width);var a=this._evilSmall.width+this._dragonSmall.width+32;this._evilSmall.x<0?(this._evilSmall.x=0-a+this._evilSmall.width,this._dragonSmall.x=0,s=this._evilSmall.x+this.game.width+a,i=this._dragonSmall.x+this.game.width+a,this._evilSmall.scale.x=-1,this._dragonSmall.scale.x=-1):(this._evilSmall.x=this.game.width+a-this._evilSmall.width,this._dragonSmall.x=this.game.width,s=this._evilSmall.x-this.game.width-a,i=this._dragonSmall.x-this.game.width-a);var h=(this.game.add.tween(this._dragonSmall).to({x:i},5e3,Phaser.Easing.Linear.None,!0),this.game.add.tween(this._evilSmall).to({x:s},5e3,Phaser.Easing.Linear.None));h.onComplete.add(this.continueOutroSky,this),h.start()},doCutsceneKeyInput:function(t){var e=t.keyCode;console.log("doCutsceneKeyInput - key.keyCode="+t.keyCode);var i=!1;37==e||100==e?i=!1:39==e||102==e?i=!1:27==e||81==e?i=!1:32==e&&(i=!1),i&&this.doBtnSkip()},shutdown:function(){console.log("***** SHUTDOWN *******")},doBtnSkip:function(){this.soundGuiButton.play(),0==this._IntroOutro?(this.game.state.states.Game._levelIndex=0,this.state.start("Game")):this.state.start("LevelSelect")},updateCutscene:function(){Math.floor(this._offset/this._icons.length)}};var TEXTDIALOG_SPEED_MS=50,CutsceneDialog=function(t,e,i){Phaser.Group.call(this,t),this.game=t,this.x=e,this.y=i,this.xOrg=e,this.yOrg=i,this._dialogtext="",this._tickercount=0,this._timer=t.time.create(!1),this._timer.loop(TEXTDIALOG_SPEED_MS,this.animateText,this),this._timeout=null,this.backPanel=t.add.sprite(0,0,"introsprites","textballoon"),this.triangle1=t.add.sprite(0,-31,"introsprites","textballoon_triangle"),this.triangle2=t.add.sprite(0,-31,"introsprites","textballoon_triangle"),this.bitmapText=t.add.bitmapText(16,16,"myfont","no text",48),this.triangle2.x=this.game.width-this.triangle1.width-112,this.add(this.backPanel),this.add(this.triangle1),this.add(this.triangle2),this.add(this.bitmapText),this.tweenFade=null,this.alpha=0};CutsceneDialog.prototype=Object.create(Phaser.Group.prototype),CutsceneDialog.prototype.constructor=CutsceneDialog,CutsceneDialog.prototype.initText=function(t,e){this._timeout&&this.game.time.events.remove(this._timeout),3==e?this.triangle1.x=Math.round((this.game.width-this.triangle1.width)/2):2==e?this.triangle1.x=this.triangle2.x:this.triangle1.x=112,this.triangle2.visible=4==e,this._dialogtext=t,this._tickercount=0,this.bitmapText.text="";var i=t.split("\n").length;this.bitmapText.y=Math.floor((this.backPanel.height-48*i)/2)-24,this.fadeInOut(!0),this.game.time.events.add(200,this._timer.start,this._timer),this.setTimeOut(4e3)},CutsceneDialog.prototype.close=function(t){this._timer.stop(!1),this.fadeInOut(!1)},CutsceneDialog.prototype.setTimeOut=function(t){this._timeout=this.game.time.events.add(t,this.close,this)},CutsceneDialog.prototype.animateText=function(){this._tickercount++,this._tickercount>this._dialogtext.length?this._timer.stop(!1):this.bitmapText.text=this._dialogtext.substring(0,this._tickercount)},CutsceneDialog.prototype.fadeInOut=function(t){var e=0,i=0;this.x=this.xOrg,1==t?(this.y=this.yOrg-40,this.alpha=0,e=this.yOrg,i=1):(this.y=this.yOrg,this.alpha=1,e=this.yOrg-40,i=0),this.tweenFade&&this.game.tweens.remove(this.tweenFade),this.tweenFade=this.game.add.tween(this).to({y:e,alpha:i},400,Phaser.Easing.Linear.None,!0)};var TutorialDialog=function(t,e){Phaser.Group.call(this,t),this.game=t,this.nextindex=e,this._txtdialog=null,this._block=null,this._handicon=null,this._swipeindex=0,this.backPanel=blockgame.createRectangle(t,0,0,t.width,t.height,0,0),this.greyPanel=this.game.add.graphics(0,0),this.greyPanel.beginFill(8421504,1),this.greyPanel.drawRect(0,0,this.game.width,320),this.greyPanel.endFill(),this.greyPanel.lineStyle(2,16777215,1),this.greyPanel.drawRect(4,4,this.game.width-8,312),this.backPanel.inputEnabled=!0,this.backPanel.priorityID=1,this.backPanel.events.onInputDown.add(this.onTutorialTouch,this),this._txtdialog=t.add.bitmapText(60,16,"myfont","no text",40),this._txtdialog.align="center",this.add(this.backPanel),this.add(this.greyPanel),this.add(this._txtdialog),this.initDialog(),this.y=Math.floor((this.game.height-this.greyPanel.height)/2),this.backPanel.y=-1*this.y,this.moveDialogInOut(!0)};TutorialDialog.prototype=Object.create(Phaser.Group.prototype),TutorialDialog.prototype.constructor=TutorialDialog,TutorialDialog.prototype.initDialog=function(){var t=this.nextindex;this.nextindex=0;var e="";switch(t){case 2:for(var i=this.children.length-1;i>=0;i--)"undefined"!=typeof this.children[i].frame&&this.children[i].destroy();e="Swipe across screen\nto slide all blocks";var s=this.game.add.sprite(180,148,"gamesprites","tutorial_box1");this._block=this.game.add.sprite(190,158,"gamesprites","tutorial_box2"),this._handicon=this.game.add.sprite(140,188,"gamesprites","tutorial_hand1"),this.add(s),this.add(this._block),this.add(this._handicon);break;case 3:e="Use as few moves as\npossible for more stars";var a=this.game.add.bitmapText(20,150,"myfont","Perfect solve:",40),h=this.game.add.bitmapText(20,198,"myfont","Double or less:",40),o=this.game.add.bitmapText(20,246,"myfont","More than double:",40),n=this.game.add.sprite(324,158,"menusprites","levelselect_star"),r=this.game.add.sprite(372,158,"menusprites","levelselect_star"),l=this.game.add.sprite(420,158,"menusprites","levelselect_star"),d=this.game.add.sprite(324,206,"menusprites","levelselect_star"),g=this.game.add.sprite(372,206,"menusprites","levelselect_star"),_=this.game.add.sprite(324,254,"menusprites","levelselect_star");this.add(a),this.add(h),this.add(o),this.add(n),this.add(r),this.add(l),this.add(d),this.add(g),this.add(_);break;case 4:e="These blocks only slide\nhorizontally or vertically";var c=this.game.add.sprite(140,202,"gamesprites","tutorial_arrow"),m=this.game.add.sprite(120,202,"gamesprites","tutorial_arrow");m.angle=180,m.y=m.y+m.height;var u=this.game.add.sprite(100,160,"gamesprites","block_65"),p=this.game.add.sprite(100,220,"gamesprites","block_66"),y=this.game.add.sprite(370,230,"gamesprites","tutorial_arrow"),b=this.game.add.sprite(334,210,"gamesprites","tutorial_arrow");y.angle=90,b.angle=270;var v=this.game.add.sprite(292,190,"gamesprites","block_69"),T=this.game.add.sprite(352,190,"gamesprites","block_70");this.add(c),this.add(m),this.add(u),this.add(p),this.add(y),this.add(b),this.add(v),this.add(T),c.x-=10,m.x-=10,y.y-=10,b.y-=10;this.game.add.tween(c).to({x:c.x+20},400,Phaser.Easing.Quadratic.InOut,!0,null,-1,!0),this.game.add.tween(m).to({x:m.x+20},400,Phaser.Easing.Quadratic.InOut,!0,null,-1,!0),this.game.add.tween(y).to({y:y.y+20},400,Phaser.Easing.Quadratic.InOut,!0,null,-1,!0),this.game.add.tween(b).to({y:b.y+20},400,Phaser.Easing.Quadratic.InOut,!0,null,-1,!0);break;case 5:e="Quantum blocks move\nas though they are\none single block.";var f=this.game.add.sprite(150,180,"gamesprites","block_36"),x=this.game.add.sprite(150,240,"gamesprites","block_40"),k=this.game.add.sprite(270,180,"gamesprites","block_36"),E=this.game.add.sprite(270,240,"gamesprites","block_40"),I=this.game.add.sprite(210,180,"gamesprites","tutorial_dotine"),O=this.game.add.sprite(210,295,"gamesprites","tutorial_dotine");this.add(f),this.add(x),this.add(k),this.add(E),this.add(I),this.add(O);break;case 6:e="Oh no, the exit is locked!\nGrab the key to unlock it.";var a=this.game.add.bitmapText(220,150,"myfont","Keys",40),h=this.game.add.bitmapText(220,230,"myfont","Locked exit",40),S=this.game.add.sprite(60,150,"gamesprites","block_72"),w=this.game.add.sprite(140,150,"gamesprites","block_73"),L=this.game.add.sprite(140,230,"gamesprites","tileexit_1");this.add(a),this.add(h),this.add(S),this.add(w),this.add(L);break;case 7:e="These sticky blocks will\nconnect together\nto form larger blocks.";var f=this.game.add.sprite(56,180,"gamesprites","block_48"),x=this.game.add.sprite(120,180,"gamesprites","block_48"),k=this.game.add.sprite(120,244,"gamesprites","block_48"),G=this.game.add.sprite(206,216,"gamesprites","tutorial_arrow"),E=this.game.add.sprite(300,180,"gamesprites","block_49"),M=this.game.add.sprite(360,180,"gamesprites","block_54"),P=this.game.add.sprite(360,240,"gamesprites","block_56");this.add(f),this.add(x),this.add(k),this.add(G),this.add(E),this.add(M),this.add(P);break;case 8:e='Peach:"Oh, I\'m so glad\nyou finally found me!"\nBlu: "Let\'s work together\nto find the exit!"';var C=this.game.add.sprite(180,220,"gamesprites","guy_10"),D=this.game.add.sprite(240,225,"gamesprites","guy_3");this.add(C),this.add(D);break;case 9:e='- Final level -\nPeach: "Look over there.\n It\'s the exit of the castle!"\nBlu: "We\'re almost there!"';var C=this.game.add.sprite(180,240,"gamesprites","guy_10"),D=this.game.add.sprite(240,245,"gamesprites","guy_4");this.add(C),this.add(D);break;case 10:e="Congratulations on\ncollecting 120 stars.\nYou have now unlocked\nthese extra difficult levels\nas a bonus reward! :)";break;default:e="Blu is trapped, help him\nto find Peach and \nescape from the castle.";var B=this.game.add.sprite(110,202,"gamesprites","guy_0"),G=this.game.add.sprite(196,214,"gamesprites","tutorial_arrow"),N=this.game.add.sprite(310,202,"gamesprites","tileexit_0");this.add(B),this.add(G),this.add(N);this.game.add.tween(G).to({x:216},300,Phaser.Easing.Quadratic.InOut,!0,null,-1,!0);this.nextindex=2}this._txtdialog.text=e,this._txtdialog.makeCentered(240),2==t&&(this.fadeInText(!0),this._swipeindex=0,this.startHandIconAnimation())},TutorialDialog.prototype.onTutorialTouch=function(t,e){this.tweenMove&&1==this.tweenMove.isRunning||this.tweenFade&&1==this.tweenFade.isRunning?console.log("onTutorialTouch --- TAP ON TUTORIAL!! still moving do nothing...."):(console.log("onTutorialTouch --- TAP ON TUTORIAL!!"),this.nextPart())},TutorialDialog.prototype.nextPart=function(){this.nextindex>0?(this.fadeInText(!1),this.tweenFade.onComplete.add(this.initDialog,this)):this.moveDialogInOut(!1)},TutorialDialog.prototype.fadeInText=function(t){var e=0,i=1;1==t?(e=0,i=1):(e=1,i=0),this.tweenFade&&this.game.tweens.remove(this.tweenFade);for(var s=this.children.length-1;s>=0;s--)"undefined"!=typeof this.children[s].frame&&(this.children[s].alpha=e,this.game.add.tween(this.children[s]).to({alpha:i},500,Phaser.Easing.Linear.None,!0,!1));this._txtdialog.alpha=e,this.tweenFade=this.game.add.tween(this._txtdialog).to({alpha:i},500,Phaser.Easing.Linear.None,!0,!1)},TutorialDialog.prototype.moveDialogInOut=function(t){var e=0,i=0;1==t?(this.x=-1*(this.game.width+32),this.alpha=1,e=0,i=1):(this.x=0,this.alpha=1,e=this.game.width+32,i=1),this.tweenMove&&this.game.tweens.remove(this.tweenMove),this.tweenMove=this.game.add.tween(this).to({x:e,alpha:i},1500,Phaser.Easing.Elastic.InOut,!0,!1)},TutorialDialog.prototype.startHandIconAnimation=function(){this._handicon.frameName="tutorial_hand2";var t=140,e=200,i=260,s=128,a=188,h=248,o=e,n=s,r=e,l=h;1==this._swipeindex&&(o=t,n=a,r=i,l=a),2==this._swipeindex&&(o=e,n=h,r=e,l=s),3==this._swipeindex&&(o=i,n=a,r=t,l=a);var d=this.game.add.tween(this._handicon).to({x:o,y:n},600,Phaser.Easing.Quadratic.InOut).to({x:r,y:l},600,Phaser.Easing.Quadratic.InOut);d.onChildComplete.add(this.doSwipeComplete.bind(this)),d.start(),t=190,i=260,s=158,h=228,o=t,n=h,1==this._swipeindex&&(o=i,n=h),2==this._swipeindex&&(o=i,n=s),3==this._swipeindex&&(o=t,n=s);var g=this.game.add.tween(this._block).to({x:o,y:n},600,Phaser.Easing.Quadratic.InOut,!1,900);g.onComplete.add(this.startHandIconAnimation.bind(this)),g.start(),this._swipeindex=(this._swipeindex+1)%4},TutorialDialog.prototype.doSwipeComplete=function(t,e){this._handicon.frameName="tutorial_hand1"};var BlockObj=function(t,e,i,s,a,h){Phaser.Group.call(this,t),this.GroupId=s,this.Obj=a,this.xGrid=0,this.yGrid=0,this.xMove=0,this.yMove=0,this.removeAnimation=!1,a>0&&OBJ_BLOCK_HORZ>=a?this.initBlock(h):this.initObject(e,i)};BlockObj.prototype=Object.create(Phaser.Group.prototype),BlockObj.prototype.constructor=BlockObj,BlockObj.prototype.initBlock=function(t){for(var e=t[0].length,i=t.length,s=0;s<t.length;s++)for(var a=0;a<t[s].length;a++)t[s][a].groupid==this.GroupId&&(e>a&&(e=a),i>s&&(i=s));this.xGrid=e,this.yGrid=i;for(var s=0;s<t.length;s++)for(var a=0;a<t[s].length;a++)if(t[s][a].groupid==this.GroupId){var h=(a-e)*TILE_SIZE,o=(s-i)*TILE_SIZE,n=0;n=this.Obj==OBJ_BLOCK_VERT?64:this.Obj==OBJ_BLOCK_HORZ?68:16*(this.Obj-1);var r=t[s][a].connect;this.Obj==OBJ_BLOCK_VERT?(4==r&&(n+=1),8==r&&(n+=2),12==r&&(n+=3)):n+=r;var l=this.game.add.sprite(h,o,"gamesprites","block_"+n);this.add(l)}this.x=e*TILE_SIZE,this.y=i*TILE_SIZE},BlockObj.prototype.initObject=function(t,e){this.xGrid=t,this.yGrid=e;var i="guy_0";this.Obj==OBJ_MAINGUY2&&(i="guy_6"),this.Obj==OBJ_KEYMOVE&&(i="block_72"),this.Obj==OBJ_KEYBOLT&&(i="block_73");var s=this.game.add.sprite(0,0,"gamesprites",i);(this.Obj==OBJ_MAINGUY1||this.Obj==OBJ_MAINGUY2)&&(s.animations.add("blink",["guy_5","guy_0"],15,!1),this.onBlink(!0)),this.Obj==OBJ_MAINGUY2&&(s.animations.add("blink",["guy_11","guy_6"],15,!1),this.onBlink(!0)),this.add(s),this.x=t*TILE_SIZE,this.y=e*TILE_SIZE},BlockObj.prototype.animatePlayer=function(t){var e=this.children[0];t==DIR_NONE?this.onBlink(!0):this.game.time.events.remove(this.blinkTimer);var i=0;switch(this.Obj==OBJ_MAINGUY2&&(i=6),t){case DIR_UP:i+=1;break;case DIR_DOWN:i+=2;break;case DIR_LEFT:i+=3;break;case DIR_RIGHT:i+=4}e.frameName="guy_"+i},BlockObj.prototype.onBlink=function(t){t||this.children[0].play("blink");var e=1e3+this.game.rnd.integerInRange(0,2e3);this.blinkTimer=this.game.time.events.add(e,this.onBlink,this)};var GAME_WIDTH=480,GAME_HEIGHT=600,DIR_UP=8,DIR_DOWN=4,DIR_LEFT=2,DIR_RIGHT=1,DIR_NONE=0,TAG_NONE=0,TAG_CHECK=1,TAG_NOTMOVE=5,TAG_CANMOVE=10,OBJ_NONE=0,OBJ_BLOCK_COLOR1=1,OBJ_BLOCK_COLOR2=2,OBJ_BLOCK_MAGIC=3,OBJ_BLOCK_STICKY=4,OBJ_BLOCK_VERT=5,OBJ_BLOCK_HORZ=6,BACK_EXIT=1,BACK_WALL=2,OBJ_MAINGUY1=15,OBJ_MAINGUY2=14,OBJ_KEYMOVE=13,OBJ_KEYBOLT=12,SLIDE_SPEED_MS=60,SWIPE_THRESHOLD=6400;blockgame.Game=function(t){this.game=t,this._levelIndex=0,this._background=null,this._grpObjs=null,this._aryTiles=null,this._objs=[],this.level_xsize=0,this.level_ysize=0,this.xoffset=0,this.yoffset=0,this.xmove_start=-1,this.ymove_start=-1,this.btnBack=null,this.btnReset=null,this.btnNext=null,this.txtLevel=null,this.txtMoves=null,this._countMoves=0,this._bestsolution="",this._tracksolution="",this._cacheMoves=[],this._countObjTweens=0,this._exitIsLocked=!1,this._gameWon=!1,this._panelGameWin=null,this._txtGameWin=null,this.fadeWhite=!1,this.emitterExit=null,this.emitterStars=null,this.emitterSwipe=null,this._cheatCodeInput="",this._cheatActive=!1},blockgame.Game.prototype={create:function(){this.stage.backgroundColor="#180321",blockgame.music_background(1),this._backwall=this.game.add.tileSprite(0,0,this.game.width,this.game.height,"gamesprites","wallpattern"),this._background=this.game.add.group(),this.startLevel();var t=1+Math.min(Math.floor(this._levelIndex/(LEVEL_SELECT_X*LEVEL_SELECT_Y)),2),e=(this.game.add.sprite(0,6,"gamesprites","banner_"+t),"Level "+(this._levelIndex+1));this.txtLevel=this.game.add.bitmapText(64,12,"myfont",e,36),this.txtMoves=this.game.add.bitmapText(236,12,"myfont","",36),this.doRefreshMoves(),this.btnBack=this.game.add.button(10,this.game.height-74-10,"buttons",this.doBtnBack,this,"exit2","exit1"),this.btnReset=this.game.add.button(210,this.game.height-74-10,"buttons",this.doBtnReset,this,"reset2","reset1"),this.btnNext=this.game.add.button(440,this.game.height-74+37-10,"buttons",this.doBtnNext,this,"play2","play1"),this.btnNext.anchor.setTo(.5,.5),this.btnSound=this.game.add.button(this.game.width-45,6,"buttons",blockgame.switch_sound,this,"soundon2","soundon1"),this.btnMusic=this.game.add.button(this.game.width-45,56,"buttons",blockgame.switch_music,this,"musicon2","musicon1"),blockgame.set_sound_btn(this.btnSound),blockgame.set_music_btn(this.btnMusic),this._panelGameWin=this.game.add.group();var i=this.game.add.graphics(0,0);i.beginFill(0,.5),i.drawRect(0,0,this.game.width,160),i.endFill(),this._panelCaption=this.game.add.bitmapText(144,12,"myfont","Excellent!",48),this._panelStar1=this.game.add.sprite(120,104,"gamesprites","starbig_0"),this._panelStar2=this.game.add.sprite(240,104,"gamesprites","starbig_0"),this._panelStar3=this.game.add.sprite(360,104,"gamesprites","starbig_0"),this._panelStar1.anchor.setTo(.5,.5),this._panelStar2.anchor.setTo(.5,.5),this._panelStar3.anchor.setTo(.5,.5),this._panelStar1.health=1,this._panelStar2.health=2,this._panelStar3.health=3,this._panelGameWin.add(i),this._panelGameWin.add(this._panelCaption),this._panelGameWin.add(this._panelStar1),this._panelGameWin.add(this._panelStar2),this._panelGameWin.add(this._panelStar3),this._panelGameWin.x=480,this.emitterExit=this.game.add.emitter(0,0,30),this.emitterExit.makeParticles("gamesprites",["sparkle_1","sparkle_2"]),this.emitterExit.setXSpeed(-300,300),this.emitterExit.setYSpeed(-300,300),this.emitterExit.setRotation(0,0),this.emitterExit.setScale(1,.1,1,.1,1e3,Phaser.Easing.None),this.emitterExit.gravity=0,this.emitterStars=this.game.add.emitter(0,0,200),this.emitterStars.makeParticles("gamesprites",["sparkle_0","sparkle_3"]),this.emitterStars.setXSpeed(-240,240),this.emitterStars.setYSpeed(-240,240),this.emitterStars.setRotation(0,0),this.emitterStars.setScale(1,.1,1,.1,1600,Phaser.Easing.None),this.emitterStars.gravity=0,this.emitterSwipe=this.game.add.emitter(0,0,400),this.emitterSwipe.makeParticles("gamesprites",["sparkle_3"]),this.emitterSwipe.setXSpeed(-50,50),this.emitterSwipe.setYSpeed(-50,50),this.emitterSwipe.setRotation(0,0),this.emitterSwipe.setScale(1,.1,1,.1,1e3,Phaser.Easing.None),this.emitterSwipe.gravity=0,this.emitterSwipe.start(!1,500,20),this.emitterSwipe.on=!1;var s=BlockGame_LevelData[this._levelIndex].tutorial;if(s){var a=!0;(!blockgame.PlayerProgress[this._levelIndex]||blockgame.PlayerProgress[this._levelIndex]<=0)&&(a=!1),(8==s||9==s||10==s)&&(delete BlockGame_LevelData[this._levelIndex].tutorial,a=!1),0==a&&(this._tutorial=new TutorialDialog(this.game,s),this.game.add.existing(this._tutorial))}blockgame.doFadeScreen(this.game,!0,!this.fadeWhite),this.fadeWhite=!1,this.soundGuiButton=this.game.add.audio("gui_button"),this.soundGuiForward=this.game.add.audio("gui_forward"),this.soundSlide=this.game.add.audio("game_slide"),this.soundBump=this.game.add.audio("game_bump"),this.soundExit=this.game.add.audio("game_exit"),this.soundWin1=this.game.add.audio("game_win1"),this.soundWin2=this.game.add.audio("game_win2"),this.soundWin3=this.game.add.audio("game_win3"),this.soundGetKey=this.game.add.audio("game_getkey"),this.soundOpenLock=this.game.add.audio("game_openlock"),this.soundSticky=this.game.add.audio("game_sticky"),this.soundVictory=this.game.add.audio("game_victory"),this.game.input.keyboard.addCallbacks(this,this.doGameKeyInput,null,null),this.game.input.onDown.add(this.doGameSwipeOnDown.bind(this)),this.game.input.addMoveCallback(this.doGameSwipeOnMove.bind(this)),this.game.input.onUp.add(this.doGameSwipeOnUp.bind(this))},shutdown:function(){var t=this.game.tweens.getAll();if(t.length>0)for(var e=t.length,i=0;e>i;i++)t[i].stop();for(var i=this._objs.length-1;i>=0;i--)this._objs[i].destroy(),delete this._objs[i]},update:function(){},render:function(){},resize:function(){console.log("resize() in Game -> size = "+window.innerHeight+" x "+window.innerWidth),this._backwall.height=this.game.height,this.centerLevel(),this.btnBack.y=this.game.height-74-10,this.btnReset.y=this.game.height-74-10,this.btnNext.y=this.game.height-74+37-10},centerLevel:function(){this.xoffset=Math.floor((this.game.width-this.level_xsize*TILE_SIZE)/2),this.yoffset=Math.floor((this.game.height-this.level_ysize*TILE_SIZE)/2),this._background.x=this.xoffset,this._background.y=this.yoffset;for(var t=0;t<this._objs.length;t++)this._objs[t].x=this._objs[t].xGrid*TILE_SIZE+this.xoffset,this._objs[t].y=this._objs[t].yGrid*TILE_SIZE+this.yoffset},startLevel:function(){this.loadLevel(),this.initLevel(),this.centerLevel(),this._countMoves=0,this._tracksolution="",this._cacheMoves=[],this._countObjTweens=0,this._cheatActive=!1,this._gameWon=!1},clearLevel:function(){this._aryTiles=[];for(var t=0;t<this.level_ysize;t++){this._aryTiles[t]=[];for(var e=0;e<this.level_xsize;e++)this._aryTiles[t][e]={back:BACK_WALL,obj:0,connect:0,groupid:0,tag:0}}},loadLevel:function(){var t=BlockGame_LevelData[0].layout;this._bestsolution="",this._levelIndex>=0&&this._levelIndex<BlockGame_LevelData.length&&(t=BlockGame_LevelData[this._levelIndex].layout,this._bestsolution=BlockGame_LevelData[this._levelIndex].solution,"undefined"==typeof this._bestsolution&&(this._bestsolution=""));var e=this.HexStringToArray(t),i=1;this.level_xsize=e[0],this.level_ysize=15&this.level_xsize,this.level_xsize=this.level_xsize>>4,this.level_xsize=this.level_xsize+2,this.level_ysize=this.level_ysize+2,this.clearLevel();for(var s=1;s<this.level_ysize-1;s++)for(var a=1;a<this.level_xsize-1;a++){var h=e[i],o=15&h,n=h>>4;0==n&&(o==OBJ_MAINGUY1||o==OBJ_MAINGUY2)&&(n=o,o=0),0==n?this._aryTiles[s][a].back=o:(this._aryTiles[s][a].back=0,this._aryTiles[s][a].obj=n,this._aryTiles[s][a].connect=o),i++}for(var r=-1,s=1;s<this.level_ysize-1;s++)for(var a=1;a<this.level_xsize-1;a++)if(this._aryTiles[s][a].obj>0&&this._aryTiles[s][a].obj<=OBJ_MAINGUY1&&0==this._aryTiles[s][a].groupid){var l=0;this._aryTiles[s][a].obj==OBJ_BLOCK_MAGIC?(-1==r&&(r=this.getFreeGroupId()),l=r):l=this.getFreeGroupId(),this.setGroupId(a,s,l)}},initLevel:function(){var t="tileexit_0";this.checkKeysLeft()&&(t="tileexit_1");for(var e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++)if(this._aryTiles[e][i].back==BACK_WALL);else if(-1!=this._aryTiles[e][i].back){var s=i+e;s=s%2?72:73;var a=this.game.add.sprite(i*TILE_SIZE,e*TILE_SIZE,"gamesprites","tileback_"+s%2);if(this._background.add(a),this._aryTiles[e][i].back==BACK_EXIT){var a=this.game.add.sprite(i*TILE_SIZE,e*TILE_SIZE,"gamesprites",t);this._background.add(a)}}for(var e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++)if(this._aryTiles[e][i].back==BACK_WALL){var h=this.GameCalcAutoConnect(i,e);if(h.Tile1<=15){var o=this.game.add.sprite(i*TILE_SIZE,e*TILE_SIZE,"gamesprites","border_"+h.Tile1);this._background.add(o)}if(h.Tile2<=15){var o=this.game.add.sprite(i*TILE_SIZE+TILE_SIZE_H,e*TILE_SIZE,"gamesprites","border_"+h.Tile2);this._background.add(o)}if(h.Tile3<=15){var o=this.game.add.sprite(i*TILE_SIZE,e*TILE_SIZE+TILE_SIZE_H,"gamesprites","border_"+h.Tile3);this._background.add(o)}if(h.Tile4<=15){var o=this.game.add.sprite(i*TILE_SIZE+TILE_SIZE_H,e*TILE_SIZE+TILE_SIZE_H,"gamesprites","border_"+h.Tile4);this._background.add(o)}}this._objs=[];for(var e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++){var n=this._aryTiles[e][i].obj;if(this._aryTiles[e][i].groupid>0&&this._aryTiles[e][i].tag==TAG_NONE){groupid=this._aryTiles[e][i].groupid;var r=new BlockObj(this.game,i,e,groupid,n,this._aryTiles);this._objs.push(r),this.game.add.existing(r),this.doObjectsTag(groupid,TAG_CHECK)}}},doMove:function(t){if(0!=this._countObjTweens){var e=-1;if(this._cacheMoves.length>0)e=this._cacheMoves[this._cacheMoves.length-1];else{var i=this._tracksolution[this._tracksolution.length-1];"U"==i&&(e=DIR_UP),"D"==i&&(e=DIR_DOWN),"L"==i&&(e=DIR_LEFT),"R"==i&&(e=DIR_RIGHT)}return t!=e&&this._cacheMoves.push(t),!1}this.clearAllTags();for(var s=0;s<this._objs.length;s++)this._objs[s].xMove=0,this._objs[s].yMove=0;for(var a=0;a<this._aryTiles.length;a++)for(var h=0;h<this._aryTiles[a].length;h++)this._aryTiles[a][h].back==BACK_WALL&&(this._aryTiles[a][h].tag=TAG_NOTMOVE),this._aryTiles[a][h].groupid>0&&(this._aryTiles[a][h].tag=TAG_CHECK);for(var o=!0,n=0;o;){n++;for(var a=0;a<this._aryTiles.length;a++)for(var h=0;h<this._aryTiles[a].length;h++)this._aryTiles[a][h].groupid>0&&this._aryTiles[a][h].tag==TAG_CHECK&&(1==this.doCheckObjectsMove(this._aryTiles[a][h].groupid,t)?this.setMovableTag(this._aryTiles[a][h].groupid,TAG_CANMOVE,t):this.setMovableTag(this._aryTiles[a][h].groupid,TAG_NOTMOVE,t));switch(t){case DIR_UP:for(var a=1;a<this._aryTiles.length;a++)for(var h=0;h<this._aryTiles[a].length;h++)this._aryTiles[a][h].groupid>0&&this._aryTiles[a][h].tag==TAG_CANMOVE&&this.doTilesSwap(h,a,h,a-1,n);break;case DIR_DOWN:for(var a=this._aryTiles.length-2;a>=0;a--)for(var h=0;h<this._aryTiles[a].length;h++)this._aryTiles[a][h].groupid>0&&this._aryTiles[a][h].tag==TAG_CANMOVE&&this.doTilesSwap(h,a,h,a+1,n);break;case DIR_LEFT:for(var a=0;a<this._aryTiles.length;a++)for(var h=1;h<this._aryTiles[a].length;h++)this._aryTiles[a][h].groupid>0&&this._aryTiles[a][h].tag==TAG_CANMOVE&&this.doTilesSwap(h,a,h-1,a,n);break;case DIR_RIGHT:for(var a=0;a<this._aryTiles.length;a++)for(var h=this._aryTiles[a].length-2;h>=0;h--)this._aryTiles[a][h].groupid>0&&this._aryTiles[a][h].tag==TAG_CANMOVE&&this.doTilesSwap(h,a,h+1,a,n)}o=!1;for(var a=0;a<this._aryTiles.length;a++)for(var h=0;h<this._aryTiles[a].length;h++)if(this._aryTiles[a][h].groupid>0&&this._aryTiles[a][h].tag==TAG_CANMOVE){o=!0;var r=this._aryTiles[a][h].groupid;this.doObjectsTag(r,TAG_CHECK);var l=!1;(this._aryTiles[a][h].obj==OBJ_MAINGUY1||this._aryTiles[a][h].obj==OBJ_MAINGUY2)&&this._aryTiles[a][h].back==BACK_EXIT&&0==this.checkKeysLeft()&&(l=!0,this.clearAryTile(h,a));for(var s=0;s<this._objs.length;s++)this._objs[s].GroupId==r&&(t==DIR_UP?this._objs[s].yMove--:t==DIR_DOWN?this._objs[s].yMove++:t==DIR_LEFT?this._objs[s].xMove--:t==DIR_RIGHT&&this._objs[s].xMove++,l&&(this._objs[s].removeAnimation=l))}}o=!1;for(var s=0;s<this._objs.length;s++)if(0!=this._objs[s].xMove||0!=this._objs[s].yMove){o=!0,this._objs[s].xGrid=this._objs[s].xGrid+this._objs[s].xMove,this._objs[s].yGrid=this._objs[s].yGrid+this._objs[s].yMove;var d=this._objs[s].x+this._objs[s].xMove*TILE_SIZE,g=this._objs[s].y+this._objs[s].yMove*TILE_SIZE,_=(Math.abs(this._objs[s].xMove)+Math.abs(this._objs[s].yMove))*SLIDE_SPEED_MS,c=this.game.add.tween(this._objs[s]).to({x:d,y:g},_,Phaser.Easing.Linear.None);if(!this._objs[s].removeAnimation){if(Math.abs(this._objs[s].yMove+this._objs[s].xMove)>1){var m=d,u=g;this._objs[s].yMove>0&&(u-=6),this._objs[s].yMove<0&&(u+=6),this._objs[s].xMove>0&&(m-=6),this._objs[s].xMove<0&&(m+=6),c.to({x:m,y:u},SLIDE_SPEED_MS,Phaser.Easing.Quadratic.InOut),c.to({x:d,y:g},SLIDE_SPEED_MS,Phaser.Easing.Quadratic.InOut)}(this._objs[s].Obj==OBJ_MAINGUY1||this._objs[s].Obj==OBJ_MAINGUY2)&&this._objs[s].animatePlayer(t),c.playBump=1}c.onChildComplete.add(this.onObjTweenChildComplete,this),c.onComplete.add(this.onObjTweenComplete,this),c.start(),this._countObjTweens++}return o&&(blockgame.soundeffect_play(this.soundSlide),t==DIR_UP?this._tracksolution+="U":t==DIR_DOWN?this._tracksolution+="D":t==DIR_LEFT?this._tracksolution+="L":t==DIR_RIGHT&&(this._tracksolution+="R"),0==this._gameWon&&(this._countMoves++,this.doRefreshMoves())),o},onObjTweenChildComplete:function(t,e){1==e.playBump&&(blockgame.soundeffect_play(this.soundBump),e.playBump=0)},onObjTweenComplete:function(t,e){1==e.playBump&&(blockgame.soundeffect_play(this.soundBump),e.playBump=0),(t.Obj==OBJ_MAINGUY1||t.Obj==OBJ_MAINGUY2)&&(t.removeAnimation?this.onMainGuyRemove(t):t.animatePlayer(DIR_NONE)),this._countObjTweens--,0==this._countObjTweens&&(this.checkStickyBlocks(),this.doNextCachedMove())},onMainGuyRemove:function(t){blockgame.soundeffect_play(this.soundExit),this.emitterExit.x=t.x+TILE_SIZE_H,this.emitterExit.y=t.y+TILE_SIZE_H,this.emitterExit.start(!1,500,1,30);this.game.add.tween(t.scale).to({x:0,y:0},600,Phaser.Easing.Quadratic.In).start(),this.game.add.tween(t).to({x:t.x+TILE_SIZE_H,y:t.y+TILE_SIZE_H},600,Phaser.Easing.Quadratic.In).start();this._gameWon=!0;for(var e=0;e<this._objs.length;e++)(this._objs[e].Obj==OBJ_MAINGUY1||this._objs[e].Obj==OBJ_MAINGUY2)&&0==this._objs[e].removeAnimation&&(this._gameWon=!1);if(this._gameWon){(this._tracksolution.length<this._bestsolution.length||""==this._bestsolution)&&(this.handleImprovedSolution(),console.log("***** improved solution: "+this._tracksolution+" *****"));var i=this._bestsolution.length;0==i&&(i=this._tracksolution.length);var s=1;this._tracksolution.length<=2*i&&s++,this._tracksolution.length<=i&&s++,this.registerLevelProgress(s),this.showGameWinPanel(s)}},handleImprovedSolution:function(){var t=navigator.userAgent||navigator.vendor||window.opera,e=navigator.language||navigator.languages[0]||"",i=platform.parse(t),s="browser="+i.name;
s+="&os="+i.os,s+="&language="+e,s+="&width="+window.innerWidth,s+="&height="+window.innerHeight,s+="&appversion="+BLOCKGAME_VERION+"&puzzleindex="+this._levelIndex+"&layout="+BlockGame_LevelData[this._levelIndex].layout+"&solution="+this._tracksolution;var a=new XMLHttpRequest;a.open("POST","http://www.bdrgames.nl/upload/bloxslider.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(s)},onKeyRemove:function(t){blockgame.soundeffect_play(this.soundGetKey);this.game.add.tween(t.scale).to({x:0,y:0},600,Phaser.Easing.Quadratic.In).start(),this.game.add.tween(t).to({x:t.x+TILE_SIZE_H,y:t.y+TILE_SIZE_H},600,Phaser.Easing.Quadratic.In).start();if(this._exitIsLocked=this.checkKeysLeft(),0==this._exitIsLocked){blockgame.soundeffect_play(this.soundOpenLock);for(var e=0;e<this._background.children.length;e++)"tileexit_1"==this._background.children[e].frameName&&(this._background.children[e].frameName="tileexit_0")}},checkKeysLeft:function(){for(var t=!1,e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++)(this._aryTiles[e][i].obj==OBJ_KEYMOVE||this._aryTiles[e][i].obj==OBJ_KEYBOLT)&&(t=!0);return t},checkStickyBlocks:function(){for(var t=[],e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++)this._aryTiles[e][i].obj==OBJ_BLOCK_STICKY&&(i<this._aryTiles[e].length-1&&this._aryTiles[e][i].obj==this._aryTiles[e][i+1].obj&&this._aryTiles[e][i].groupid!=this._aryTiles[e][i+1].groupid&&(this._aryTiles[e][i].connect=this._aryTiles[e][i].connect|DIR_RIGHT,this._aryTiles[e][i+1].connect=this._aryTiles[e][i+1].connect|DIR_LEFT,-1==t.indexOf(this._aryTiles[e][i].groupid)&&t.push(this._aryTiles[e][i].groupid),-1==t.indexOf(this._aryTiles[e][i+1].groupid)&&t.push(this._aryTiles[e][i+1].groupid)),e<this._aryTiles.length-1&&this._aryTiles[e][i].obj==this._aryTiles[e+1][i].obj&&this._aryTiles[e][i].groupid!=this._aryTiles[e+1][i].groupid&&(this._aryTiles[e][i].connect=this._aryTiles[e][i].connect|DIR_DOWN,this._aryTiles[e+1][i].connect=this._aryTiles[e+1][i].connect|DIR_UP,-1==t.indexOf(this._aryTiles[e][i].groupid)&&t.push(this._aryTiles[e][i].groupid),-1==t.indexOf(this._aryTiles[e+1][i].groupid)&&t.push(this._aryTiles[e+1][i].groupid)));for(var s=0;s<t.length;s++){this.changeGroupId(t[s],0);for(var a=0;a<this._objs.length;a++)this._objs[a].GroupId==t[s]&&(this._objs[a].destroy(!0),delete this._objs[a],this._objs.splice(a,1))}for(var h=0,e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++)if(this._aryTiles[e][i].obj==OBJ_BLOCK_STICKY&&0==this._aryTiles[e][i].groupid){var o=this.getFreeGroupId();this.setGroupId(i,e,o);var n=new BlockObj(this.game,i,e,o,OBJ_BLOCK_STICKY,this._aryTiles);n.x=n.x+this.xoffset,n.y=n.y+this.yoffset,this._objs.push(n),this.game.add.existing(n),h++}h>0&&(blockgame.soundeffect_play(this.soundSticky),this.game.world.bringToTop(this.emitterSwipe),this.game.world.bringToTop(this.emitterExit),this.game.world.bringToTop(this._panelGameWin),this.game.world.bringToTop(this.emitterStars))},doNextCachedMove:function(){if(this._cacheMoves.length>0){var t=this._cacheMoves.shift();0==this.doMove(t)&&(this._cacheMoves=[])}},clearAllTags:function(){for(var t=0;t<this._aryTiles.length;t++)for(var e=0;e<this._aryTiles[t].length;e++)this._aryTiles[t][e].tag=TAG_NONE},doObjectsTag:function(t,e){for(var i=0;i<this._aryTiles.length;i++)for(var s=0;s<this._aryTiles[i].length;s++)this._aryTiles[i][s].groupid==t&&(this._aryTiles[i][s].tag=e)},getFreeGroupId:function(){for(var t=0,e=0;e<this._aryTiles.length;e++)for(var i=0;i<this._aryTiles[e].length;i++)this._aryTiles[e][i].groupid>t&&(t=this._aryTiles[e][i].groupid);return t+1},setMovableTag:function(t,e,i){for(var s=0;s<this._aryTiles.length;s++)for(var a=0;a<this._aryTiles[s].length;a++)this._aryTiles[s][a].groupid==t&&(this._aryTiles[s][a].tag=e);if(e==TAG_NOTMOVE)for(var s=0;s<this._aryTiles.length;s++)for(var a=0;a<this._aryTiles[s].length;a++)if(this._aryTiles[s][a].groupid==t){var h=-1,o=OBJ_NONE;switch(i){case DIR_UP:s<this._aryTiles.length&&this._aryTiles[s+1][a].tag!=TAG_NOTMOVE&&this._aryTiles[s+1][a].groupid>0&&this._aryTiles[s+1][a].groupid!=t&&(h=this._aryTiles[s+1][a].groupid,o=this._aryTiles[s+1][a].obj);break;case DIR_DOWN:s>0&&this._aryTiles[s-1][a].tag!=TAG_NOTMOVE&&this._aryTiles[s-1][a].groupid>0&&this._aryTiles[s-1][a].groupid!=t&&(h=this._aryTiles[s-1][a].groupid,o=this._aryTiles[s-1][a].obj);break;case DIR_LEFT:a<this._aryTiles[s].length&&this._aryTiles[s][a+1].tag!=TAG_NOTMOVE&&this._aryTiles[s][a+1].groupid>0&&this._aryTiles[s][a+1].groupid!=t&&(h=this._aryTiles[s][a+1].groupid,o=this._aryTiles[s][a+1].obj);break;case DIR_RIGHT:a>0&&this._aryTiles[s][a-1].tag!=TAG_NOTMOVE&&this._aryTiles[s][a-1].groupid>0&&this._aryTiles[s][a-1].groupid!=t&&(h=this._aryTiles[s][a-1].groupid,o=this._aryTiles[s][a-1].obj)}if(-1!=h){var n=this.doCheckGuyKey(this._aryTiles[s][a].obj,o);0==n&&this.setMovableTag(h,e,i)}}},setGroupId:function(t,e,i){this._aryTiles[e][t].groupid=i,this._aryTiles[e][t].connect&DIR_UP&&e>0&&this._aryTiles[e-1][t].groupid!=i&&this.setGroupId(t,e-1,i),this._aryTiles[e][t].connect&DIR_DOWN&&e<this._aryTiles.length&&this._aryTiles[e+1][t].groupid!=i&&this.setGroupId(t,e+1,i),this._aryTiles[e][t].connect&DIR_LEFT&&t>0&&this._aryTiles[e][t-1].groupid!=i&&this.setGroupId(t-1,e,i),this._aryTiles[e][t].connect&DIR_RIGHT&&t>0&&this._aryTiles[e][t+1].groupid!=i&&this.setGroupId(t+1,e,i)},changeGroupId:function(t,e){for(var i=0;i<this._aryTiles.length;i++)for(var s=0;s<this._aryTiles[i].length;s++)this._aryTiles[i][s].groupid==t&&(this._aryTiles[i][s].groupid=e)},doCheckObjectsMove:function(t,e){for(var i=0;i<this._aryTiles.length;i++)for(var s=0;s<this._aryTiles[i].length;s++)if(this._aryTiles[i][s].groupid==t)switch(e){case DIR_UP:if(this._aryTiles[i][s].obj==OBJ_BLOCK_VERT||this._aryTiles[i][s].obj==OBJ_KEYBOLT)return!1;if(1>i)return!1;if(0!=this.doCheckGuyKey(this._aryTiles[i][s].obj,this._aryTiles[i-1][s].obj))return!0;if(this._aryTiles[i-1][s].tag==TAG_NOTMOVE)return!1;break;case DIR_DOWN:if(this._aryTiles[i][s].obj==OBJ_BLOCK_VERT||this._aryTiles[i][s].obj==OBJ_KEYBOLT)return!1;if(i>=this._aryTiles.length-1)return!1;if(0!=this.doCheckGuyKey(this._aryTiles[i][s].obj,this._aryTiles[i+1][s].obj))return!0;if(this._aryTiles[i+1][s].tag==TAG_NOTMOVE)return!1;break;case DIR_LEFT:if(this._aryTiles[i][s].obj==OBJ_BLOCK_HORZ||this._aryTiles[i][s].obj==OBJ_KEYBOLT)return!1;if(1>s)return!1;if(0!=this.doCheckGuyKey(this._aryTiles[i][s].obj,this._aryTiles[i][s-1].obj))return!0;if(this._aryTiles[i][s-1].tag==TAG_NOTMOVE)return!1;break;case DIR_RIGHT:if(this._aryTiles[i][s].obj==OBJ_BLOCK_HORZ||this._aryTiles[i][s].obj==OBJ_KEYBOLT)return!1;if(s>=this._aryTiles[i].length-1)return!1;if(0!=this.doCheckGuyKey(this._aryTiles[i][s].obj,this._aryTiles[i][s+1].obj))return!0;if(this._aryTiles[i][s+1].tag==TAG_NOTMOVE)return!1}return!0},doCheckGuyKey:function(t,e){return t!=OBJ_MAINGUY1&&t!=OBJ_MAINGUY2||e!=OBJ_KEYMOVE&&e!=OBJ_KEYBOLT?e!=OBJ_MAINGUY1&&e!=OBJ_MAINGUY2||t!=OBJ_KEYMOVE&&t!=OBJ_KEYBOLT?0:2:1},doTilesSwap:function(t,e,i,s,a){var h=this.doCheckGuyKey(this._aryTiles[e][t].obj,this._aryTiles[s][i].obj);if(0!=h){var o=this._aryTiles[e][t].groupid;1==h?(o=this._aryTiles[s][i].groupid,this.clearAryTile(i,s)):this.clearAryTile(t,e);for(var n=0;n<this._objs.length;n++)if(this._objs[n].GroupId==o){var r=a*SLIDE_SPEED_MS;this.game.time.events.add(r,this.onKeyRemove,this,this._objs[n])}}if(2!=h){var l=this._aryTiles[s][i];this._aryTiles[s][i]=this._aryTiles[e][t],this._aryTiles[e][t]=l;var d=this._aryTiles[s][i].back;this._aryTiles[s][i].back=this._aryTiles[e][t].back,this._aryTiles[e][t].back=d}},clearAryTile:function(t,e){this._aryTiles[e][t].groupid=0,this._aryTiles[e][t].obj=0,this._aryTiles[e][t].connect=0,this._aryTiles[e][t].tag=0},getGameObjectAtPosition:function(t){var e=Math.floor((t.x-this.xoffset)/TILE_SIZE),i=Math.floor((t.y-this.yoffset)/TILE_SIZE),s="X";return e>=0&&e<this.level_xsize&&i>=0&&i<this.level_ysize&&(this._aryTiles[i][e].obj==OBJ_MAINGUY1||this._aryTiles[i][e].obj==OBJ_MAINGUY2?s="A":this._aryTiles[i][e].back==BACK_EXIT&&(s="B")),s},checkCheatCode:function(){if(this._cheatCodeInput.length>8&&(this._cheatCodeInput=this._cheatCodeInput.substring(this._cheatCodeInput.length-8)),"ABABAABB"==this._cheatCodeInput&&(this._cheatCodeInput="",0==this._countMoves)){for(var t=0;t<this._bestsolution.length;t++){var e=this._bestsolution.substring(t,t+1),i=DIR_UP;"D"==e&&(i=DIR_DOWN),"L"==e&&(i=DIR_LEFT),"R"==e&&(i=DIR_RIGHT),this._cacheMoves.push(i)}this._cheatActive=!0,this.doNextCachedMove()}},doGameSwipeOnDown:function(t){this.emitterSwipe.on=!0,this.xmove_start=t.x,this.ymove_start=t.y,this._cheatCodeInput+=this.getGameObjectAtPosition(t),this.checkCheatCode()},doGameSwipeOnMove:function(t){if(t.isDown){this.emitterSwipe.emitX=t.x,this.emitterSwipe.emitY=t.y,-1==this.xmove_start&&-1==this.ymove_start&&(this.xmove_start=t.x,this.ymove_start=t.y);var e=t.x-this.xmove_start,i=t.y-this.ymove_start,s=DIR_NONE;-1*TILE_SIZE>i&&(s=DIR_UP),i>TILE_SIZE&&(s=DIR_DOWN),-1*TILE_SIZE>e&&(s=DIR_LEFT),e>TILE_SIZE&&(s=DIR_RIGHT),s!=DIR_NONE&&(this.doMove(s),this.xmove_start=-1,this.ymove_start=-1)}},doGameSwipeOnUp:function(t){this.emitterSwipe.on=!1,this.xmove_start=-1,this.ymove_start=-1},doGameKeyInput:function(t){var e=t.keyCode;switch(console.log("doGameKey -- kc="+e),e){case 38:case 104:case 87:this.doMove(DIR_UP);break;case 40:case 98:case 83:this.doMove(DIR_DOWN);break;case 37:case 100:case 65:this.doMove(DIR_LEFT);break;case 39:case 102:case 68:this.doMove(DIR_RIGHT);break;case 27:case 81:this.doBtnBack();break;case 82:this.doBtnReset();break;case 32:case 78:this.doBtnNext()}},doRefreshMoves:function(){this.txtMoves.text="Moves: "+this._countMoves+"/"+this._bestsolution.length},GameGridAutoConnect:function(t,e,i,s,a){var h=0;return e==t&&(h+=4),i==t&&(h+=2),s==t&&(h+=1),4==h&&(h=0),5==h&&(h=1),6==h&&(h=2),7==h&&(h=4),h=4*h+a},GameCalcAutoConnect:function(t,e){var i=0,s=0,a=[];for(s=0;3>s;s++)for(a[s]=[],i=0;3>i;i++){var h=t-1+i,o=e-1+s;h>=0&&o>=0&&h<this._aryTiles[s].length&&o<this._aryTiles.length?a[s][i]=this._aryTiles[o][h].back:a[s][i]=BACK_WALL}var n={Tile1:0,Tile2:0,Tile3:0,Tile4:0};return n.Tile1=this.GameGridAutoConnect(a[1][1],a[0][0],a[0][1],a[1][0],0),n.Tile2=this.GameGridAutoConnect(a[1][1],a[0][2],a[1][2],a[0][1],1),n.Tile3=this.GameGridAutoConnect(a[1][1],a[2][0],a[1][0],a[2][1],2),n.Tile4=this.GameGridAutoConnect(a[1][1],a[2][2],a[2][1],a[1][2],3),n},showGameWinPanel:function(t){var e=1e3,i=400;blockgame.soundeffect_play(this.soundVictory),this.game.time.events.add(e+i+240,this.doStarReveal,this,this._panelStar1),t>=2&&this.game.time.events.add(e+i+240+360,this.doStarReveal,this,this._panelStar2),t>=3&&this.game.time.events.add(e+i+240+720,this.doStarReveal,this,this._panelStar3);var s="Good!";2==t&&(s="Fantastic!"),3==t&&(s="Excellent!"),this._cheatActive&&(s="Cheater!"),this._panelCaption.text=s,this._panelCaption.makeCentered(240),this._panelGameWin.y=Math.floor(this.game.height/2-80),this.game.add.tween(this._panelGameWin).to({x:0},i,Phaser.Easing.Back.Out,!0,e),this.btnNext.visible=!0,this.game.add.tween(this.btnNext.scale).to({x:1.2,y:1.2},500,Phaser.Easing.Sinusoidal.InOut,!0,e,-1,!0)},doStarReveal:function(t){2==t.health&&blockgame.soundeffect_play(this.soundWin2),3==t.health?blockgame.soundeffect_play(this.soundWin3):blockgame.soundeffect_play(this.soundWin1),t.frameName="starbig_1",this.emitterStars.x=this._panelGameWin.x+t.x,this.emitterStars.y=this._panelGameWin.y+t.y,this.emitterStars.start(!0,800,null,15),this.game.add.tween(t).to({angle:360},3e3,Phaser.Easing.Sinusoidal.InOut,!0,!1,-1,!0)},registerLevelProgress:function(t){var e=!1;0==this._cheatActive&&(!blockgame.PlayerProgress[this._levelIndex]||blockgame.PlayerProgress[this._levelIndex]<t)&&(blockgame.PlayerProgress[this._levelIndex]=t,e=!0),this._levelIndex<BlockGame_LevelData.length-1&&(!blockgame.PlayerProgress[this._levelIndex+1]||blockgame.PlayerProgress[this._levelIndex+1]<0)&&(blockgame.PlayerProgress[this._levelIndex+1]=0,e=!0),e&&window.localStorage.setItem("blockgame_progress",JSON.stringify(blockgame.PlayerProgress))},ArrayToHexString:function(t){for(var e="",i=0;i<t.length;i++){var s=t[i].toString(16);s=("00"+s).substr(-2),e+=s}return e},HexStringToArray:function(t){var e=[],i=0,s=t.length;if(s%2!=0)return e;s=Math.floor(s/2);for(var a=0;s>a;a++){var h=2*a,o=t.substring(h,h+2),n=parseInt(o,16);e[i]=n,i++}return e},doBtnBack:function(){blockgame.soundeffect_play(this.soundGuiButton);var t=blockgame.doFadeScreen(this.game,!1,!0);t.onComplete.add(function(){this.state.start("LevelSelect")},this)},doBtnReset:function(){blockgame.soundeffect_play(this.soundGuiButton),this.fadeWhite=!0,this.doFadeOutReset()},doFadeOutReset:function(){var t=blockgame.doFadeScreen(this.game,!1,!this.fadeWhite);t.onComplete.add(function(){this.state.start("Game",!0,!1)},this)},doBtnNext:function(){blockgame.soundeffect_play(this.soundGuiForward),this.registerLevelProgress(0);var t=BlockGame_LevelData.length;if(this._levelIndex==t-1){for(var e=!0,i=0;t>i;i++)if(blockgame.PlayerProgress[i]<=0){e=!1;break}e?(this.game.state.states.Cutscene._IntroOutro=1,this.state.start("Cutscene")):this.state.start("LevelSelect")}else this._levelIndex++,this._levelIndex>BlockGame_LevelData.length-1?this.state.start("LevelSelect"):this.doFadeOutReset()}};